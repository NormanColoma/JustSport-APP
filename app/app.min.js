function SportListController(a,b){function c(){a.getSports().then(function(a){for(var c="",d=0;d<a.count;d++)c+=d+1<a.count?a.rows[d].name+", ":a.rows[d].name;return b.setIndexes(a),c.split(/, +/g).map(function(a){var b={value:a.toLowerCase(),display:a};return g.sports.push(b)})})}function d(a){var b=a?g.sports.filter(e(a)):g.sports;return b}function e(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}}function f(a){return{name:a.display,id:b.getIndexOf(a.display)}}var g=this;g.loadAll=c,g.querySearch=d,g.selectedItem=null,g.searchText=null,g.sports=[],g.transformChip=f,c()}function sportListService(a,b){function c(){function a(a){return a.Sports}function b(a){console.log(a)}return f.get({limit:100}).$promise.then(a)["catch"](b)}var d="https://justsport-api.herokuapp.com/api",e=d,f=a(e+"/sports/:id",{id:"@id"},{query:{isArray:!1,method:"GET"}}),g={getSports:c};return g}function scrollTo(){function a(a,b,c){var d=$("#scroll"),e=$("#results"),f=$("#results2");$(".est-title");b.on("click",function(){"scrollResults"==c.id?$("body").animate({scrollTop:e.offset().top},"slow"):"scrollResults2"==c.id?$("body").animate({scrollTop:f.offset().top},"slow"):"update-estab"==c.id||"addEst"===c.id||"listEst"===c.id||"addCourse"===c.id||"listCourses"===c.id?$("body").animate({scrollTop:$("body").offset().top},"slow"):"getDetails"==c.id?$("body").animate({scrollTop:$("body").offset().top},"slow"):$("body").animate({scrollTop:d.offset().top},"slow")})}var b={link:a,restrict:"A"};return b}function filteredResults(){var a={templateUrl:"app/home/est-results.html",restrict:"E"};return a}function establishmentFilteredService(a){function b(a,b,c){function d(a){return a}function e(a){return a.data.message}return"none"===c&&(c=void 0),h.get({id:a,location:b,after:c,limit:5}).$promise.then(d)["catch"](e)}function c(a){return e.get(a)}function d(a){for(var b=0;b<a.rows.length;b++)e.set(a.rows[b].name,a.rows[b].id)}var e=new Map,f="https://justsport-api.herokuapp.com/api",g=f,h=a(g+"/establishments/sport/:id/location/:location",{id:"@id",location:"@location"},{query:{isArray:!1,method:"GET"}}),i={getEstablishments:b,getIndexOf:c,setIndexes:d};return i}function getScheduleService(a){function b(a){function b(a){var b={sportId:a.Sport.id,establishmentId:a.Establishment.id,instructor:a.instructor,price:a.price,info:a.info};return b}function c(a){return a.data.message}return m.get({id:a}).$promise.then(b)["catch"](c)}function c(){return l}function d(a,b){function c(a){return a.Schedule.rows}function d(a){return a.data.message}return m.fullSchedule({id:a,sport:b}).$promise.then(c)["catch"](d)}function e(a){function b(a){return a.Schedule.rows}function c(a){return a.data.message}return m.schedule({id:a}).$promise.then(b)["catch"](c)}function f(){return k}function g(a){l=a}function h(a){k=a}var i="https://justsport-api.herokuapp.com/api",j=i,k=null,l=null,m=a(j+"/courses/:id",{id:"@id"},{schedule:{method:"GET",url:j+"/courses/:id/schedule",isArray:!1},fullSchedule:{method:"GET",url:j+"/establishments/:id/sport/:sport/schedule",isArray:!1}}),n={getCourse:b,getEstab:c,getFullSchedule:d,getSchedule:e,getSport:f,setEstab:g,setSport:h};return n}function citySuggestionsService(a){function b(b){return a.get(d+"/establishments/"+b+"/suggestions").then(function(a){return a.data.locations})}var c="https://justsport-api.herokuapp.com/api",d=c,e={getCities:b};return e}function HomeController(a,b){function c(b){return a.getCities(b).then(function(a){return a})}var d=this;d.querySearch=c}function ShowScheduleController(a,b,c){function d(){i.course=null}function e(b){a.getCourse(b).then(function(a){void 0!==a.info&&(i.course=a)})}function f(b,c){a.getFullSchedule(b,c).then(function(a){"There is no schedule established yet"!==a?(i.schedule=a,i.timetable=i.schedule):(i.schedule=null,i.timetable=i.schedule)})}function g(){c.cancel()}function h(c,d){var e="app/home/est-schedule.tmpl.html";a.setEstab(d),b.showCustomDialog(c,e)}var i=this;i.backToSchedule=d,i.course=null,i.estab=a.getEstab(),i.sport=a.getSport(),i.getCourse=e,i.getSchedule=f,i.hideSchedule=g,i.schedule=null,i.showSchedule=h,i.timetable=null}function EstablishmentFilteredController(a,b,c){function d(a){if(j.items.length>0)for(var b=0;b<a.length;b++)f(a[b])||(j.items=j.items.concat(a[b]));else j.items=j.items.concat(a)}function e(e){var f={};j.activated=!1,j.prevLocation==j.location&&j.prevSport==j.sport||(j.items=[],j.after="none"),a.getEstablishments(j.sport,j.location,j.after).then(angular.bind(this,function(a){"There no more rows to retrieve"===a?j.activated=!0:"There are no establishments that match the current filter"===a?(j.activated=!0,"none"===j.after&&(f={title:"Sin resultados",text:"No se han encontrado establecimientos para la búsqueda introducida.",aria:"Establishment Dialog",textButton:"Listo"},b.showDialog(f,e)),j.after="none"):(c.setSport(j.sport),j.activated=!0,j.after=a.paging.cursors.after,d(a.Establishments.rows),j.prevLocation=j.location,j.prevSport=j.sport)}))}function f(a){for(var b=!1,c=0;c<j.items.length;c++)if(j.items[c].id===a.id){b=!0;break}return b}function g(b){void 0!==b&&(j.sport=a.getIndexOf(b.display))}function h(a){void 0!==a&&(j.location=a)}function i(a){var b=a;return a.length>200&&(b=a.slice(0,200),b+="."!=b[199]?"...":".."),b}var j=this,k="https://justsport-api.herokuapp.com/",l=k;j.activated=!0,j.addItems=d,j.after="none",j.fetchMore=e,j.imgFolder=l+"public/images/ests/",j.items=[],j.location=null,j.prevLocation=null,j.prevSport=null,j.searchItem=f,j.selectedItemChange=g,j.selectedLocationChange=h,j.shortenDesc=i,j.sport=null}function loginService(a){function b(b,c){function e(a){return a.data}function g(a){return a.data}var h={username:b,password:c,grant_type:"password",client_id:d};return a.post(f+"/oauth2/token",h).then(e)["catch"](g)}function c(){return void 0!==localStorage.username}var d="2xa001za-78b3-4f38-9376-e2dd88b7c682",e="https://justsport-api.herokuapp.com/api",f=e,g={getToken:b,isLoggedIn:c};return g}function LoginController(a,b,c,d,e,f){function g(){return!(localStorage.expires<=Date.now())}function h(){l.stop=!1,a.isLoggedIn()?(l.loggedIn=!0,l.name=localStorage.username,l.role=localStorage.role,f.checkRedirect(c.url(),c.absUrl(),l.loggedIn,l.role)&&(l.stop=!0,l.reload&&(b.location.href=n))):f.checkRedirect(c.url(),c.absUrl(),l.loggedIn,l.role)&&(l.stop=!0,l.reload&&(b.location.href=n+"account/#/login"))}function i(c,e,f){void 0!==c&&void 0!==e&&(l.loginProgress=!0,a.getToken(c,e).then(function(a){if(a.error){l.loginProgress=!1;var c={title:"Login incorrecto",text:"El email o la contraseña introducidos, no son correctos.",aria:"Login User Alert",textButton:"Listo"};d.showDialog(c,f)}else localStorage.setItem("token",a.access_token),localStorage.setItem("username",a.username),localStorage.setItem("role",a.role),localStorage.setItem("user_id",a.user_id),localStorage.setItem("expires",a.expires),l.loggedIn=!0,l.name=a.username,l.role=a.role,l.reload&&(b.location.href=n)}))}function j(){l.loggedIn=!1,l.name=null,l.role=null,localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("user_id"),localStorage.removeItem("expires"),e("right").close(),l.reload&&(b.location.href=n)}function k(){e("right").toggle()}var l=this,m="https://justsport-api.herokuapp.com/api/",n=c.protocol()+"://"+c.host()+":"+c.port()+"/";"server"===c.host()&&(n=m),l.checkToken=g,l.isLoggedIn=h,l.loggedIn=!1,l.login=i,l.loginProgress=!1,l.logout=j,l.name=null,l.openMenu=k,l.registerView=!1,l.reload=!0,l.role=null,l.stop=!1}function RegisterController(a,b,c){function d(b){h.registerView?(h.registerView=!1,a.path("/login")):(h.registerView=!0,a.path("/register")),f(b)}function e(d){if(void 0!==h.user.email&&void 0!==h.user.password&&void 0!==h.user.name&&void 0!==h.user.lname&&void 0!==h.user.gender){var e={};h.registeringUser=!0,void 0!==h.user.role?h.user.role="owner":h.user.role="user",b.registerUser(h.user).then(function(b){b===!0?(h.registered=!0,h.registeringUser=!1,h.registerView=!1,a.path("/login"),e={title:"¡Bienvenido!",text:"Su cuenta se ha creado correctamente.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d)):(h.registered=!1,h.registeringUser=!1,e={title:"¡Cuenta existente!",text:"No se ha podido crear su cuenta. El email "+h.user.email+" ya está registrado.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d))})}}function f(a){void 0!==a&&(a.$setPristine(),a.$setUntouched(),h.user={})}function g(){var b=a.path();"/register"===b?h.registerView=!0:"login"===b&&(a.path("/login"),h.registerView=!1)}var h=this;h.changeView=d,h.register=e,h.registered=!0,h.registerView=!1,h.registeringUser=!1,h.resetForm=f,h.selectView=g,g()}function registerUserService(a){function b(b){function c(a){return!0}function e(a){return a.data.errors[0].message}var f={name:b.name,lname:b.lname,email:b.email,pass:b.password,gender:b.gender,role:b.role};return a.post(d+"/users/new",f).then(c)["catch"](e)}var c="https://justsport-api.herokuapp.com/api",d=c,e={registerUser:b};return e}function EstablishmentDetailsController(a,b,c,d){function e(c,d,e){void 0!==d&&null!==d&&a.addComm(c,d).then(function(a){n.commentaries.push(a),b.reset(e),n.text=null})}function f(a){var b=a.indexOf("T"),c=a.slice(0,b),d=a.slice(b+1,a.indexOf(".")),e=c.slice(5,7),f=c.slice(0,4),g=c.slice(8,10),h=j(d.slice(0,2)),i=d.slice(3,5),l=d.slice(6,8);return d=h+":"+i+":"+l,e=k(e),a=g+" de "+e+" "+f+", "+d}function g(b){a.getEstablishment(b).then(function(a){"There was an error when loading establishment"===a||(n.establishment=a.Establishment,n.commentaries=a.Commentaries,n.votes=a.Votes,n.courses=a.Courses)})}function h(b,c){for(var e=0;e<n.courses.length;e++)n.courses[e].id===b&&(a.setCourse(n.courses[e]),n.course=n.courses[e]);var f="app/establishment-details/course-schedule.tmpl.html";d.showCustomDialog(c,f)}function i(a){c.getSchedule(a).then(function(a){"There are no schedules for this course"===a?n.schedule=[]:n.schedule=a})}function j(a){return a=parseInt(a),22===a?a="00":23===a?a="01":24===a?a="02":(a+=2,a=a.toString(),1===a.length&&(a="0"+a)),a}function k(a){return a="01"===a?"Enero":"02"===a?"Febrero":"03"===a?"Marzo":"04"===a?"Abril":"05"===a?"Mayo":"06"===a?"Junio":"07"===a?"Julio":"08"===a?"Agosto":"09"===a?"Septiembre":"10"===a?"Octubre":"11"===a?"Noviembre":"Diciembre"}function l(){d.hideDialog()}function m(){n.establishment=null,n.commentaries=[],n.votes=0,n.courses=[]}var n=this,o="https://justsport-api.herokuapp.com/",p=o;n.addCommentary=e,n.commentaries=[],n.course=a.getCourse(),n.courses=[],n.establishment=null,n.formatDate=f,n.getCourse=h,n.getEstablishment=g,n.getHour=j,n.getMonth=k,n.getSchedule=i,n.hideSchedule=l,n.imgFolder=p+"public/images/users/",n.removeEstab=m,n.schedule=[],n.votes=0}function establishmentDetailsService(a,b){function c(a,c){function d(a){return a.data.Commentary}function e(a){var b={message:"Something failed"};return b}var f={text:c};return b({method:"POST",url:i+"/establishments/"+a+"/commentaries/new",headers:{Authorization:"Bearer "+localStorage.token},data:f}).then(d)["catch"](e)}function d(){return j}function e(a){function b(a){var b={Establishment:{id:a.id,name:a.name,desc:a.desc,city:a.city,province:a.province,addr:a.addr,phone:a.phone,website:a.website,main_img:a.main_img},Votes:a.Votes.length,Commentaries:a.Commentaries,Courses:a.Courses};return b}function c(a){var b={message:"There was an error when loading establishment"};return b}return k.get({id:a}).$promise.then(b)["catch"](c)}function f(a){j=a}function g(a){function b(){return!0}function c(){return!1}return k.vote({id:a}).$promise.then(b)["catch"](c)}var h="https://justsport-api.herokuapp.com/api",i=h,j=null,k=a(i+"/establishments/:id",{id:"@id"},{query:{isArray:!1,method:"GET"},vote:{method:"POST",url:i+"/establishments/:id/votes/new",headers:{Authorization:"Bearer "+localStorage.token}}}),l={addComm:c,getCourse:d,getEstablishment:e,setCourse:f,vote:g};return l}function establishmentDetails(){var a={templateUrl:"app/establishment-details/est-details.html",restrict:"E"};return a}function establishmentVote(a,b){function c(c,d,e,f,g){d.on("click",function(){if(void 0!==localStorage.token){var c=parseInt(e.id.substr(5,6));a.vote(c).then(function(a){if(a){var c=parseInt($(".like-cnt").text())+1;$(".like-cnt").text(c)}else{var d={title:"¡Votación ya realizada!",text:"No puedes votar más de una vez el mismo establecimiento",aria:"Vote User Alert",textButton:"Listo"};b.showDialog(d,g)}})}else{var d={title:"Login Requerido",text:"Para poder votar este establecimiento, primero debes loguearte.",aria:"Login User Alert",textButton:"Listo"};b.showDialog(d,g)}})}var d={restrict:"EA",link:c,controller:EstablishmentDetailsController,controllerAs:"vm",bindToController:!0};return d}function UserAccountController(a,b,c,d,e){function f(b,e){var f={};a.uploadImg(b).then(function(a){a?(d.imgFolder=l+"public/images/users/"+b.name,f={title:"¡Imagen Subida!",text:"Tu nueva imagen de perfil ha sido actualizada",aria:"Updated IMG User Alert",textButton:"Listo"},c.showDialog(f,e)):(f={title:"¡Error de Subida!",text:"La imagen es demasiado pesada. No puede pesar más de 512Kb",aria:"Updated IMG User Error Alert",textButton:"Listo"},c.showDialog(f,e))})}function g(b){a.closeAccount(b).then(function(a){j.closed=a})}function h(){e.isLoggedIn()&&a.getUser(j.user_id).then(function(a){void 0===a.message&&("owner"===a.role?j.account.role="Propietario":j.account.role="Usuario",j.user=a,d.imgFolder=d.imgFolder+j.user.img)})}function i(d,e,f){if(void 0!==d.pass&&void 0!==j.acc.current){var g={},h=d,i=d.role;"Usuario"===h.role?h.role="user":h.role="owner",a.updateAccount(j.user_id,h).then(function(a){a?(j.updated=!0,b.reset(e),j.account={role:i},j.acc={},g={title:"¡Información Actualizada!",text:"Tu cuenta ha sido actualizada "+j.user.name,aria:"Updated User Alert",textButton:"Listo"},c.showDialog(g,f)):(j.updated=!1,g={title:"¡Error!",text:"Se ha encontrado un error durante la actualización. Por favor, intentalo de nuevo",aria:"Updated User Error Alert",textButton:"Listo"},c.showDialog(g,f))})}}var j=this,k="https://justsport-api.herokuapp.com/",l=k;j.account={},j.closeAccount=g,j.closed=!1,j.getUser=h,d.imgFolder=l+"public/images/users/",j.updateAccount=i,j.uploadImg=f,j.updated=!1,j.user={},j.user_id=localStorage.user_id}function userAccountService(a,b){function c(a){function b(){return!0}function c(){return!1}return i["delete"]({id:a}).$promise.then(b)["catch"](c)}function d(a){function b(a){var b={name:a.name,lname:a.lname,role:a.role,gender:a.gender,img:a.img};return b}function c(a){var b={message:"An error occurred"};return b}return i.get({id:a}).$promise.then(b)["catch"](c)}function e(a,b){function c(){return!0}function d(a){return!1}return i.update({id:a},b).$promise.then(c)["catch"](d)}function f(a){function c(){return!0}function d(){return!1}var e=new FormData;return e.append("user_profile",a),b({method:"PUT",url:h+"/users/me/profile/image",data:e,headers:{Authorization:"Bearer "+localStorage.token,"Content-Type":void 0}}).then(c)["catch"](d)}var g="https://justsport-api.herokuapp.com/api",h=g,i=a(h+"/users/:id",{id:"@id"},{query:{isArray:!1,method:"GET"},"delete":{method:"DELETE",url:h+"/users/:id",headers:{Authorization:"Bearer "+localStorage.token}},update:{method:"PUT",url:h+"/users/:id",headers:{Authorization:"Bearer "+localStorage.token}}}),j={closeAccount:c,getUser:d,updateAccount:e,uploadImg:f};return j}function uploadBtn(){function a(a,b,c,d,e){var f=$("#fileInput");$("#userProfileImg");b.on("click",function(){f.click(),f.bind("change",function(){if(f.get(0).files.length>0){var a=f.get(0).files[0];d.uploadImg(a,e)}})})}var b={estrict:"EA",link:a,controller:UserAccountController,controllerAs:"vm",bindToController:!0};return b}function backofficeTabs(){var a={templateUrl:"app/backoffice/back-office-tabs.html",restrict:"E"};return a}function backofficeEstabs(){var a={templateUrl:"app/backoffice-estabs/back-office-estabs.html",restrict:"E"};return a}function backofficeAddEst(){var a={templateUrl:"app/backoffice-estabs/back-office-add-est.html",restrict:"E"};return a}function impartSport(){var a={templateUrl:"app/backoffice-estabs/impart-sport.html",restrict:"E"};return a}function deleteEstab(a,b){function c(c,d,e,f,g){d.on("click",function(){console.log("me ha clickado");var c=parseInt(e.name),d=a.confirm().title("¿Quieres eliminar el establecimiento?").textContent("Al eliminar el establecimiento, se eliminarán también todos sus cursos y horarios.").ariaLabel("Delete Estab").targetEvent(g).ok("Eliminar").cancel("Cancelar");a.show(d).then(function(){var a=null;a="delete-estab"===e.id?$("#estab-"+c):$("#estab-"+c+"-m"),b.deleteEstablishment(c).then(function(b){b===!0&&a.fadeOut("normal",function(){$(this).remove()})})},function(){})})}var d={restrict:"EA",link:c};return d}function updateEstab(){var a={templateUrl:"app/backoffice-estabs/update-estab.html",restrict:"E"};return a}function uploadEstBtn(a,b){function c(c,d,e,f){d.on("click",function(){var c=e.name,d=$("#img-estab-btn-"+c),g={};d.change(function(){if(d.get(0).files.length>0){var e=d.get(0).files[0];if(e.size<512e3&&("image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type)){var h=$(".md-card-image-"+c),i="https://justsport-api.herokuapp.com/public/images/ests/",j=i,k=j+e.name;b.uploadImg(e,c).then(function(b){b&&(h.attr("src",k),g={title:"¡Imagen Subida!",text:"La imagen de perfil del establecimiento, se ha subido correctamente.",aria:"Updated Estab Img Alert",textButton:"Listo"},a.showDialog(g,f))})}else d.val(""),g={title:"¡Error!",text:"La imagen debe ser de tipo jpg o png, y no puede pesar más de 512Kb.",aria:"Updated Estab Img Error Alert",textButton:"Listo"},a.showDialog(g,f)}})})}var d={estrict:"EA",link:c};return d}function backOfficeEstabService(a,b){function c(a){function b(a){var b={id:a.id,name:a.name,desc:a.desc,city:a.city,province:a.province,addr:a.addr,phone:a.phone,website:a.website,main_img:a.main_img};return b}function c(a){var b={message:"An error occurred when posting establishment"};return b}return n.addEstab(a).$promise.then(b)["catch"](c)}function d(a){function b(a){return!0}function c(a){return!1}return n.deleteEstablishment({id:a}).$promise.then(b)["catch"](c)}function e(){return m}function f(){function a(a){l=a.Establishments;var b=[];m=[];for(var c=0;c<l.rows.length;c++){var d={id:l.rows[c].id,name:l.rows[c].name},e={establishmentId:l.rows[c].id,rows:l.rows[c].Courses};b.push(d),m.push(e)}return b}function b(a){var b={message:"An error occurred"};return b}return n.getEsts({limit:200}).$promise.then(a)["catch"](b)}function g(a){function b(a){console.log("entro"),l=a.Establishments;for(var b=[],c=0;c<l.rows.length;c++){var d={id:l.rows[c].id,name:l.rows[c].name,desc:l.rows[c].desc,city:l.rows[c].city,province:l.rows[c].province,addr:l.rows[c].addr,phone:l.rows[c].phone,website:l.rows[c].website,main_img:l.rows[c].main_img};b.push(d)}var e={Establishments:b,paging:a.paging};return e}function c(a){var b={message:"An error occurred"};return b}return"none"===a&&(a=void 0),n.getEsts({limit:3,after:a}).$promise.then(b)["catch"](c)}function h(a,b){function c(a){return!0}function d(a){return!1}return n.updateEstab({id:a},b).$promise.then(c)["catch"](d)}function i(a,c){function d(){return!0}function e(){return!1}var f=new FormData;return f.append("est_profile",a),b({method:"PUT",url:k+"/establishments/"+c+"/new/image",data:f,headers:{Authorization:"Bearer "+localStorage.token,"Content-Type":void 0}}).then(d)["catch"](e)}var j="https://justsport-api.herokuapp.com/api",k=j,l=null,m=[],n=a(k+"/establishments/:id",{id:"@id"},{addEstab:{method:"POST",url:k+"/establishments/new",headers:{Authorization:"Bearer "+localStorage.token}},getEsts:{isArray:!1,method:"GET",url:k+"/establishments/me/all",headers:{Authorization:"Bearer "+localStorage.token}},deleteEstablishment:{method:"DELETE",url:k+"/establishments/:id",headers:{Authorization:"Bearer "+localStorage.token}},updateEstab:{method:"PUT",url:k+"/establishments/:id",headers:{Authorization:"Bearer "+localStorage.token}}}),o={addEstablishment:c,deleteEstablishment:d,getCourses:e,getEstabs:g,getFullEsts:f,updateEstablishment:h,uploadImg:i};return o}function backOfficeSportService(a){function b(a){function b(a){var b={id:a.id,name:a.name};return b}function c(a){return a.data.errors[0].message}return g.addSp(a).$promise.then(b)["catch"](c)}function c(a,b){function c(a){return!0}function d(a){return!1}return g.associateSp({id:a},b).$promise.then(c)["catch"](d)}function d(a){function b(a){return a.Sports.rows}function c(a){return[]}return g.getSports({id:a,limit:200}).$promise.then(b)["catch"](c)}var e="https://justsport-api.herokuapp.com/api",f=e,g=a(f+"/establishments/:id",{id:"@id"},{associateSp:{method:"PUT",url:f+"/establishments/:id/sports/new",headers:{Authorization:"Bearer "+localStorage.token}},getSports:{isArray:!1,method:"GET",url:f+"/establishments/:id/sports"},addSp:{method:"POST",url:f+"/sports/new",headers:{Authorization:"Bearer "+localStorage.token}}}),h={addSp:b,associateSp:c,getSports:d};return h}function BackOfficeEstabController(a,b,c,d,e,f){function g(c,d,f){r.estab.owner=localStorage.user_id,r.estab.main_img="default.jpg";var g={};a.addEstablishment(c).then(function(a){void 0===a.message?(r.estabs.push(a),e.reset(f),r.estab={},r.searchText=null,r.searchTextProvince=null,g={title:"¡Establecimiento Añadido!",text:"El establecimiento ha sido añadido correctamente.",aria:"Estab Added Alert",textButton:"Listo"},j("listEstabs"),b.showDialog(g,d)):g={title:"¡Erro al Añadir!",text:"El establecimiento no se ha podido añadir. Por favor, vuelve a intentar añadir el mismo.",aria:"Estab Added Alert Failed",textButton:"Listo"}})}function h(a,c,d){var e={};if(0===c.length)e={title:"Selecciona un Deporte",text:"Debes seleccionar como mínimo un deporte.",aria:"Estab Added Alert",textButton:"Listo"},b.showDialog(e,d);else{for(var f=0;f<c.length;f++){var g={id:c[f].id},h=c[f];i(a,g,h)}r.selectedSports=[],r.sports.length>0?(e={title:"Deportes ya impartidos",text:"Los deportes seleccionados ya están impartidos para este establecimiento",aria:"Sport Added Alert",textButton:"Listo"},b.showDialog(e,d)):(e={title:"Deportes Impartidos",text:"Los deportes se han impartido correctamente",aria:"Sport Added Alert",textButton:"Listo"},b.showDialog(e,d))}}function i(a,b,c){f.associateSp(a,b).then(function(a){a&&(r.sports.push(c),r.currentSports.push(c))})}function j(a,b){r.view=a,r.id=b,r.selectedItem=null,r.searchText=null,r.selectedItemProvince=null,r.searchTextProvince=null,"assocSp"===a?m(b):"updateEstab"===a&&k(b)}function k(a){for(var b=0;b<r.estabs.length;b++)r.estabs[b].id===a&&(r.selectedEst=angular.copy(r.estabs[b]),r.selectedItem=r.estabs[b].city,r.searchText=r.estabs[b].city,r.selectedItemProvince=r.estabs[b].province,r.searchTextProvince=r.estabs[b].province)}function l(b){c.isLoggedIn()&&a.getEstabs(r.after).then(angular.bind(this,function(a){if("An error occurred"===a.message)r.estabs=[],r.view="listEstabs";else{r.after=a.paging.cursors.after;for(var b=0;b<a.Establishments.length;b++)for(var c=0;c<r.estabs.length;c++)r.estabs[c].name===a.Establishments[b].name&&a.Establishments.splice(b,1);r.estabs=r.estabs.concat(a.Establishments),r.view="listEstabs"}}))}function m(a){f.getSports(a).then(function(a){r.currentSports=a})}function n(a){return d.getCities(a).then(function(a){return a})}function o(a){r.estab.city=a}function p(a){r.estab.province=a}function q(c,d,e,f){var g={},h=d;d.owner=localStorage.user_id,a.updateEstablishment(c,d).then(function(a){if(a){for(var d=0;d<r.estabs.length;d++)r.estabs[d].id===c&&(delete h.owner,r.estabs[d]=h);g={title:"¡Establecimiento Actualizado!",text:"La información del establecimiento ha sido actualizada.",aria:"Estab Updated Alert",textButton:"Listo"},j("listEstabs"),b.showDialog(g,e)}else g={title:"¡Error durante la Actualización!",text:"Se ha producido un error durante la actualziación. Por favor, inténtalo de nuevo.",aria:"Estab Failed Alert",textButton:"Listo"},b.showDialog(g,e)})}var r=this,s="https://justsport-api.herokuapp.com/",t=s;r.addEstablishment=g,r.addSport=i,r.associateSport=h,r.after="none",r.changeView=j,r.currentSports=[],r.estabs=[],r.fullEstabs=[],r.getEstab=k,r.getEstabs=l,r.getSports=m,r.id=0,r.imgFolder=t+"public/images/ests/",r.querySearch=n,r.selectedSports=[],r.searchCityChange=o,r.searchProvinceChange=p,r.selectedEst=null,r.sports=[],r.view="none",r.updateEstab=q}function addSport(){var a={templateUrl:"app/backoffice-sports/add-sport.html",restrict:"E"};return a}function BackOfficeSportController(a,b,c){function d(d,f,g){var h={},i={name:d};c.addSp(i).then(function(c){c.name?(e.sport=c,b.reset(f),e.sp={},h={title:"¡Deporte Añadido!",text:'El deporte con nombre "'+d+'" ha sido añadido correctamente.',aria:"Added Sp Alert",textButton:"Listo"},a.showDialog(h,g)):(h={title:"¡Deporte Añadido!",text:'El deporte con nombre "'+d+'" ya existe en JustSport.',aria:"Added Sp Alert Failed",textButton:"Listo"},a.showDialog(h,g))})}var e=this;e.addSport=d,e.sport={}}function listCourses(){var a={templateUrl:"app/backoffice-courses/list-courses.html",restrict:"E"};return a}function updateCourse(){var a={templateUrl:"app/backoffice-courses/update-course.html",restrict:"E"};return a}function addCourse(){var a={templateUrl:"app/backoffice-courses/add-course.html",restrict:"E"};return a}function deleteSc(a,b){function c(a,c,d){c.on("click",function(){var a=parseInt(d.name),c=d.id.split("delete-schedule-"),e=parseInt(c[1]),f=$("#schedule-"+a);b.deleteSchedule(a,e).then(function(a){a===!0&&f.fadeOut("normal",function(){$(this).remove()})})})}var d={restrict:"EA",link:c};return d}function addSchedule(){var a={templateUrl:"app/backoffice-schedule/add-schedule.html",restrict:"E"};return a}function backOfficeCoursesService(a,b){function c(a){function b(a){var b={id:a.id,info:a.info,instructor:a.instructor,price:a.price};return b}function c(a){return!1}return h.add(a).$promise.then(b)["catch"](c)}function d(a,b){function c(a){return!0}function d(a){return!1}return h.update({id:a},b).$promise.then(c)["catch"](d)}function e(a){function b(a){return!0}function c(a){return!1}return h["delete"]({id:a}).$promise.then(b)["catch"](c)}var f="https://justsport-api.herokuapp.com/api",g=f,h=a(g+"/courses/:id",{id:"@id"},{update:{method:"PUT",url:g+"/courses/:id",headers:{Authorization:"Bearer "+localStorage.token}},"delete":{method:"DELETE",url:g+"/courses/:id",headers:{Authorization:"Bearer "+localStorage.token}},add:{method:"POST",url:g+"/courses/new",headers:{Authorization:"Bearer "+localStorage.token}}}),i={add:c,deleteCourse:e,update:d};return i}function BackOfficeCoursesController(a,b,c,d,e,f,g){function h(c,d,e){var g={};f.add(c).then(function(f){if(f===!1)g={title:"¡Error!",text:"El curso no ha podido ser añadido. Por favor, inténtalo de nuevo.",aria:"Added Course Failed Alert",textButton:"Listo"},a.showDialog(g,d);else{for(var h=0;h<t.courses.length;h++)t.courses[h].establishmentId===parseInt(c.establishmentId)&&t.courses[h].rows.push(f);g={title:"¡Curso Añadido!",text:"El curso ha sido añadido correctamente.",aria:"Added Course Alert",textButton:"Listo"},b.reset(e),c={},j(),a.showDialog(g,d)}})}function i(c,d,e){var f={};c.courseId=t.selectedCourse,g.add(c).then(function(g){g===!0?(t.schedule.push(c),t.addSchedView=!1,f={title:"¡Hora Añadida!",text:"La hora ha sido correctamente añadida al horario.",aria:"Added Schedule Alert",textButton:"Listo"},b.reset(d),t.newSchedule={},a.showDialog(f,e)):(f={title:"¡Error!",text:"No se ha podido añadir la hora al horario. Por favor, inténtalo de nuevo.",aria:"Added Schedule Alert Failed",textButton:"Listo"},a.showDialog(f,e))})}function j(){t.selectedC=null,t.selectedEst=null,t.selectedCourse=null,t.currentCourses=[],t.schedule=[],t.addView=!1,t.addSchedView=!1,t.emptySchedule=!1}function k(){t.addSchedView=!0,t.emptySchedule=!1}function l(b,c){var d={};f.deleteCourse(b).then(function(e){if(e){for(var f=0;f<t.courses.length;f++)for(var g=0;g<t.courses[f].rows.length;g++)t.courses[f].rows[g].id===b&&t.courses[f].rows.splice(g,1);d={title:"¡Curso eliminado!",text:"El curso y sus horarios asociados, han sido eliminados correctamente.",aria:"Deleted Courses Alert",textButton:"Listo"},j(),a.showDialog(d,c)}else d={title:"¡Error!",text:"El curso no se ha podido eliminar. Por favor, inténtalo de nuevo.",aria:"Deleted Courses Alert Failed",textButton:"Listo"},a.showDialog(d,c)})}function m(b,c){for(var d={},e=0;e<t.schedule.length;e++)t.schedule[e].id===b&&t.schedule.splice(e,1);d={title:"¡Horario eliminado!",text:"El horario seleccionado, ha sido eliminado correctamente.",aria:"Deleted Schedule Alert",textButton:"Listo"},a.showDialog(d,c)}function n(a){for(var b=0;b<t.courses.length;b++)for(var c=0;c<t.courses[b].rows.length;c++)t.courses[b].rows[c].id===parseInt(a)&&(t.course=t.courses[b].rows[c],t.selectedC=angular.copy(t.courses[b].rows[c]))}function o(b,c){t.currentCourses=[];for(var d={},e=0;e<t.courses.length;e++)if(t.courses[e].establishmentId===parseInt(b))for(var f=0;f<t.courses[e].rows.length;f++)t.currentCourses.push(t.courses[e].rows[f]);0===t.currentCourses.length&&(d={title:"¡Sin resultados!",text:"El establecimiento seleccionado no tiene cursos asignados todavía.",aria:"Search Courses Alert",textButton:"Listo"},a.showDialog(d,c))}function p(){d.isLoggedIn()&&e.getFullEsts().then(function(a){t.fullEstabs=a,t.courses=e.getCourses()})}function q(a){n(a);for(var b=0;b<t.courses.length;b++)for(var c=0;c<t.courses[b].rows.length;c++)t.courses[b].rows[c].id===parseInt(a)&&(t.courses[b].rows[c].Schedule.length>0?t.schedule=t.courses[b].rows[c].Schedule:t.emptySchedule=!0);console.log(t.emptySchedule)}function r(b,c,d){var e={info:c.info,instructor:c.instructor,price:c.price},g={};f.update(b,e).then(function(c){c?(s(b,e),g={title:"¡Curso Actualizado!",text:"La información del curso ha sido actualizada.",aria:"Course Updated Alert",textButton:"Listo"},j(),a.showDialog(g,d)):(g={title:"¡Error!",text:"Se ha producido un error durante la actualización. Por favor, inténtalo de nuevo.",aria:"Course Updated Failed Alert",textButton:"Listo"},a.showDialog(g,d))})}function s(a,b){n(a),void 0!==b.info&&(t.course.info=b.info),void 0!==b.price&&(t.course.price=b.price),void 0!==b.instructor&&(t.course.instructor=b.instructor)}var t=this;t.addCourse=h,t.addSchedule=i,t.addSchedView=!1,t.addView=!1,t.backToList=j,t.changeView=k,t.course=null,t.courses=[],t.currentCourses=[],t.deleteCourse=l,t.deleteSchedule=m,t.emptySchedule=!1,t.getCourse=n,t.getCourses=o,t.getFullEstabs=p,t.getSchedule=q,t.modifyValues=s,t.schedule=[],t.sports=[],t.updateCourse=r,p()}function listSchedule(){var a={templateUrl:"app/backoffice-schedule/list-schedule.html",restrict:"E"};return a}function backOfficeScheduleService(a,b){function c(a){function b(a){return!0}function c(a){return!1}return g.add(a).$promise.then(b)["catch"](c)}function d(a,c){function d(a){return!0}function e(a){return!1}var g={courseId:c};return b({method:"DELETE",url:f+"/schedules/"+a,data:g,headers:{Authorization:"Bearer "+localStorage.token,"Content-Type":"application/json;charset=utf-8"}}).then(d)["catch"](e)}var e="https://justsport-api.herokuapp.com/api",f=e,g=a(f+"/schedules/:id",{id:"@id"},{add:{method:"POST",url:f+"/schedules/new",headers:{Authorization:"Bearer "+localStorage.token}}}),h={add:c,deleteSchedule:d};return h}function mobileTabs(){var a={templateUrl:"app/backoffice/mobile-tabs.html",restrict:"E"};return a}function computerTabs(){var a={templateUrl:"app/backoffice/computer-tabs.html",restrict:"E"};return a}function addEstMobile(){var a={templateUrl:"app/backoffice-estabs/add-est-mobile.html",restrict:"E"};return a}function updateEstMobile(){var a={templateUrl:"app/backoffice-estabs/update-est-mobile.html",restrict:"E"};return a}function formResetService(){function a(a){void 0!==a&&(a.$setPristine(),a.$setUntouched())}var b={reset:a};return b}function dialogService(a){
function b(){a.cancel()}function c(b,c){a.show(a.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(b.title).textContent(b.text).ariaLabel(b.aria).ok(b.textButton).targetEvent(c))}function d(b,c){a.show({templateUrl:c,parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0})}var e={hideDialog:b,showCustomDialog:d,showDialog:c};return e}function redirectService(a){function b(a,b,c,d){return"/login"===a||"https://justsportapp.herokuapp.com/account"===b||"https://localhost:5000/account"===b||"http://localhost:5000/account"===b?!!c:"/account/profile"===a||"https://justsportapp.herokuapp.com/account/profile"===b||"https://localhost:5000/account/profile"===b||"http://localhost:5000/account/profile"===b?!c:"/backoffice"===a||"https://justsportapp.herokuapp.com/backoffice"===b||"https://localhost:5000/backoffice"===b||"http://localhost:5000/backoffice"===b?!c||"owner"!==d&&"admin"!==d:!1}var c={checkRedirect:b};return c}angular.module("sportModule",["ngResource"]),angular.module("sportModule").controller("SportListController",SportListController),SportListController.$inject=["sportListService","establishmentFilteredService"],angular.module("sportModule").factory("sportListService",sportListService),sportListService.$inject=["$resource"],angular.module("homeModule",[]),angular.module("homeModule").directive("scrollTo",scrollTo),angular.module("homeModule").directive("filteredResults",filteredResults),angular.module("homeModule").factory("establishmentFilteredService",establishmentFilteredService),establishmentFilteredService.$inject=["$resource"],angular.module("homeModule").factory("getScheduleService",getScheduleService),getScheduleService.$inject=["$resource"],angular.module("homeModule").factory("citySuggestionsService",citySuggestionsService),citySuggestionsService.$inject=["$http"],angular.module("homeModule").controller("HomeController",HomeController),HomeController.$inject=["citySuggestionsService","$http"],angular.module("homeModule").controller("ShowScheduleController",ShowScheduleController),ShowScheduleController.$inject=["getScheduleService","dialogService","$mdDialog"],angular.module("homeModule").controller("EstablishmentFilteredController",EstablishmentFilteredController),EstablishmentFilteredController.$inject=["establishmentFilteredService","dialogService","getScheduleService"],angular.module("loginModule",[]),angular.module("loginModule").factory("loginService",loginService),loginService.$inject=["$http"],angular.module("loginModule").controller("LoginController",LoginController),LoginController.$inject=["loginService","$window","$location","dialogService","$mdSidenav","redirectService"],angular.module("registerModule",[]),angular.module("registerModule").controller("RegisterController",RegisterController),RegisterController.$inject=["$location","registerUserService","dialogService"],angular.module("registerModule").factory("registerUserService",registerUserService),registerUserService.$inject=["$http"],angular.module("establishmentModule",[]),angular.module("establishmentModule").controller("EstablishmentDetailsController",EstablishmentDetailsController),EstablishmentDetailsController.$inject=["establishmentDetailsService","formResetService","getScheduleService","dialogService"],angular.module("establishmentModule").factory("establishmentDetailsService",establishmentDetailsService),establishmentDetailsService.$inject=["$resource","$http"],angular.module("establishmentModule").directive("establishmentDetails",establishmentDetails),angular.module("establishmentModule").directive("establishmentVote",establishmentVote),establishmentVote.$inject=["establishmentDetailsService","dialogService"],angular.module("userAccountModule",[]),angular.module("userAccountModule").controller("UserAccountController",UserAccountController),UserAccountController.$inject=["userAccountService","formResetService","dialogService","$scope","loginService"],angular.module("userAccountModule").factory("userAccountService",userAccountService),userAccountService.$inject=["$resource","$http"],angular.module("userAccountModule").directive("uploadBtn",uploadBtn),angular.module("backOfficeModule",[]),angular.module("backOfficeModule").directive("backofficeTabs",backofficeTabs),angular.module("backOfficeModule").directive("backofficeEstabs",backofficeEstabs),angular.module("backOfficeModule").directive("backofficeAddEst",backofficeAddEst),angular.module("backOfficeModule").directive("impartSport",impartSport),angular.module("backOfficeModule").directive("deleteEstab",deleteEstab),deleteEstab.$inject=["$mdDialog","backOfficeEstabService"],angular.module("backOfficeModule").directive("updateEstab",updateEstab),angular.module("backOfficeModule").directive("uploadEstBtn",uploadEstBtn),uploadEstBtn.$inject=["dialogService","backOfficeEstabService"],angular.module("backOfficeModule").factory("backOfficeEstabService",backOfficeEstabService),backOfficeEstabService.$inject=["$resource","$http"],angular.module("backOfficeModule").factory("backOfficeSportService",backOfficeSportService),backOfficeSportService.$inject=["$resource"],angular.module("backOfficeModule").controller("BackOfficeEstabController",BackOfficeEstabController),BackOfficeEstabController.$inject=["backOfficeEstabService","dialogService","loginService","citySuggestionsService","formResetService","backOfficeSportService"],angular.module("backOfficeModule").directive("addSport",addSport),angular.module("backOfficeModule").controller("BackOfficeSportController",BackOfficeSportController),BackOfficeSportController.$inject=["dialogService","formResetService","backOfficeSportService"],angular.module("backOfficeModule").directive("listCourses",listCourses),angular.module("backOfficeModule").directive("updateCourse",updateCourse),angular.module("backOfficeModule").directive("addCourse",addCourse),angular.module("backOfficeModule").directive("deleteSc",deleteSc),deleteSc.$inject=["$mdDialog","backOfficeScheduleService"],angular.module("backOfficeModule").directive("addSchedule",addSchedule),angular.module("backOfficeModule").factory("backOfficeCoursesService",backOfficeCoursesService),backOfficeCoursesService.$inject=["$resource","$http"],angular.module("backOfficeModule").controller("BackOfficeCoursesController",BackOfficeCoursesController),BackOfficeCoursesController.$inject=["dialogService","formResetService","backOfficeSportService","loginService","backOfficeEstabService","backOfficeCoursesService","backOfficeScheduleService"],angular.module("backOfficeModule").directive("listSchedule",listSchedule),angular.module("backOfficeModule").factory("backOfficeScheduleService",backOfficeScheduleService),backOfficeScheduleService.$inject=["$resource","$http"],angular.module("backOfficeModule").directive("mobileTabs",mobileTabs),angular.module("backOfficeModule").directive("computerTabs",computerTabs),angular.module("backOfficeModule").directive("addEstMobile",addEstMobile),angular.module("backOfficeModule").directive("updateEstMobile",updateEstMobile),function(){"use strict";angular.module("justSport",["ngMaterial","ngMessages","homeModule","sportModule","loginModule","registerModule","establishmentModule","userAccountModule","backOfficeModule"]).config(["$mdThemingProvider",function(a){var b={50:"#65acf3",100:"#4d9ff1",200:"#3692ef",300:"#1e85ed",400:"#1279e0",500:"#106CC8",600:"#0e5fb0",700:"#0c5299",800:"#0a4681",900:"#08396a",A100:"#7cb8f5",A200:"#94c5f6",A400:"#acd2f8",A700:"#072c52",contrastDefaultColor:"light"};a.definePalette("customPrimary",b),a.theme("default").primaryPalette("customPrimary")}])}(),angular.module("justSport").factory("formResetService",formResetService),angular.module("justSport").factory("dialogService",dialogService),dialogService.$inject=["$mdDialog"],angular.module("justSport").factory("redirectService",redirectService),redirectService.$inject=["$window"];