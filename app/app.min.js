function SportListController(a,b){function c(){a.getSports().then(function(a){for(var c="",d=0;d<a.count;d++)c+=d+1<a.count?a.rows[d].name+", ":a.rows[d].name;return b.setIndexes(a),c.split(/, +/g).map(function(a){var b={value:a.toLowerCase(),display:a};return f.sports.push(b)})})}function d(a){var b=a?f.sports.filter(e(a)):f.sports;return b}function e(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}}var f=this;f.loadAll=c,f.querySearch=d,f.selectedItem=null,f.searchText=null,f.sports=[],c()}function sportListService(a,b){function c(){function a(a){return a.Sports}function b(a){console.log(a)}return f.get({limit:100}).$promise.then(a)["catch"](b)}var d="https://justsport-api.herokuapp.com/api",e=d,f=a(e+"/sports/:id",{id:"@id"},{query:{isArray:!1,method:"GET"}}),g={getSports:c};return g}function scrollTo(){function a(a,b,c){var d=$("#scroll"),e=$("#results");b.on("click",function(){"scrollResults"==c.id?$("body").animate({scrollTop:e.offset().top},"slow"):$("body").animate({scrollTop:d.offset().top},"slow")})}var b={link:a,restrict:"A"};return b}function filteredResults(){var a={templateUrl:"app/home/est-results.html",restrict:"E"};return a}function establishmentFilteredService(a){function b(a,b,c){function d(a){return a}function e(a){return a.data.message}return"none"===c&&(c=void 0),h.get({id:a,location:b,after:c}).$promise.then(d)["catch"](e)}function c(a){return e.get(a)}function d(a){for(var b=0;b<a.rows.length;b++)e.set(a.rows[b].name,a.rows[b].id)}var e=new Map,f="https://justsport-api.herokuapp.com/api",g=f,h=a(g+"/establishments/sport/:id/location/:location",{id:"@id",location:"@location"},{query:{isArray:!1,method:"GET"}}),i={getEstablishments:b,getIndexOf:c,setIndexes:d};return i}function getScheduleService(a){function b(a){function b(a){var b={sportId:a.Sport.id,establishmentId:a.Establishment.id,instructor:a.instructor,price:a.price,info:a.info};return b}function c(a){return a.data.message}return m.get({id:a}).$promise.then(b)["catch"](c)}function c(){return l}function d(a,b){function c(a){return a.Schedule.rows}function d(a){return a.data.message}return m.fullSchedule({id:a,sport:b}).$promise.then(c)["catch"](d)}function e(a){function b(a){return a.Schedule.rows}function c(a){return a.data.message}return m.schedule({id:a}).$promise.then(b)["catch"](c)}function f(){return k}function g(a){l=a}function h(a){k=a}var i="https://justsport-api.herokuapp.com/api",j=i,k=null,l=null,m=a(j+"/courses/:id",{id:"@id"},{schedule:{method:"GET",url:j+"/courses/:id/schedule",isArray:!1},fullSchedule:{method:"GET",url:j+"/establishments/:id/sport/:sport/schedule",isArray:!1}}),n={getCourse:b,getEstab:c,getFullSchedule:d,getSchedule:e,getSport:f,setEstab:g,setSport:h};return n}function citySuggestionsService(a){function b(b){return a.get(d+"/establishments/"+b+"/suggestions").then(function(a){return a.data.locations})}var c="https://justsport-api.herokuapp.com/api",d=c,e={getCities:b};return e}function HomeController(a,b){function c(b){return a.getCities(b).then(function(a){return a})}var d=this;d.querySearch=c}function ShowScheduleController(a,b,c){function d(){i.course=null}function e(b){a.getCourse(b).then(function(a){void 0!==a.info&&(i.course=a)})}function f(b,c){a.getFullSchedule(b,c).then(function(a){"There is no schedule established yet"!==a?(i.schedule=a,i.timetable=i.schedule):(i.schedule=null,i.timetable=i.schedule)})}function g(){c.cancel()}function h(c,d){var e="app/home/est-schedule.tmpl.html";a.setEstab(d),b.showCustomDialog(c,e)}var i=this;i.backToSchedule=d,i.course=null,i.estab=a.getEstab(),i.sport=a.getSport(),i.getCourse=e,i.getSchedule=f,i.hideSchedule=g,i.schedule=null,i.showSchedule=h,i.timetable=null}function EstablishmentFilteredController(a,b,c){function d(d){var e={};h.activated=!1,h.prevLocation==h.location&&h.prevSport==h.sport||(h.items=[],h.after="none"),a.getEstablishments(h.sport,h.location,h.after).then(angular.bind(this,function(a){"There no more rows to retrieve"===a?h.activated=!0:"There are no establishments that match the current filter"===a?(h.activated=!0,e={title:"Sin resultados",text:"No se han encontrado establecimientos para la búsqueda introducida.",aria:"Establishment Dialog",textButton:"Listo"},b.showDialog(e,d)):(c.setSport(h.sport),h.activated=!0,h.after=a.paging.cursors.after,h.items=h.items.concat(a.Establishments.rows),h.prevLocation=h.location,h.prevSport=h.sport)}))}function e(b){void 0!==b&&(h.sport=a.getIndexOf(b.display))}function f(a){void 0!==a&&(h.location=a)}function g(a){var b=a;return a.length>200&&(b=a.slice(0,200),b+="."!=b[199]?"...":".."),b}var h=this,i="https://justsport-api.herokuapp.com/",j=i;h.activated=!0,h.after="none",h.fetchMore=d,h.imgFolder=j+"public/images/ests/",h.items=[],h.location=null,h.prevLocation=null,h.prevSport=null,h.selectedItemChange=e,h.selectedLocationChange=f,h.shortenDesc=g,h.sport=null}function loginService(a){function b(b,c){function e(a){return a.data}function g(a){return a.data}var h={username:b,password:c,grant_type:"password",client_id:d};return a.post(f+"/oauth2/token",h).then(e)["catch"](g)}function c(){return void 0!==localStorage.username}var d="2xa001za-78b3-4f38-9376-e2dd88b7c682",e="https://justsport-api.herokuapp.com/api",f=e,g={getToken:b,isLoggedIn:c};return g}function LoginController(a,b,c,d,e){function f(){return!(localStorage.expires<=Date.now())}function g(){k.stop=!1,a.isLoggedIn()?(k.loggedIn=!0,k.name=localStorage.username,k.role=localStorage.role,"/login"!==c.url()&&"https://justsportapp.herokuapp.com/account"!==c.absUrl()&&"https://localhost:5000/account"!==c.absUrl()&&"http://localhost:5000/account"!==c.absUrl()||(k.stop=!0,k.reload&&(b.location.href=m))):"/account/profile"!==c.url()&&"https://justsportapp.herokuapp.com/account/profile"!==c.absUrl()&&"https://localhost:5000/account/profile"!==c.absUrl()&&"http://localhost:5000/account/profile"!==c.absUrl()||(k.stop=!0,k.reload&&(b.location.href=m+"account/#/login"))}function h(c,e,f){void 0!==c&&void 0!==e&&(k.loginProgress=!0,a.getToken(c,e).then(function(a){if(a.error){k.loginProgress=!1;var c={title:"Login incorrecto",text:"El email o la contraseña introducidos, no son correctos.",aria:"Login User Alert",textButton:"Listo"};d.showDialog(c,f)}else localStorage.setItem("token",a.access_token),localStorage.setItem("username",a.username),localStorage.setItem("role",a.role),localStorage.setItem("user_id",a.user_id),localStorage.setItem("expires",a.expires),k.loggedIn=!0,k.name=a.username,k.role=a.role,k.reload&&(b.location.href=m)}))}function i(){k.loggedIn=!1,k.name=null,k.role=null,localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("user_id"),localStorage.removeItem("expires"),e("right").close(),k.reload&&(b.location.href=m)}function j(){e("right").toggle()}var k=this,l="https://justsport-api.herokuapp.com/api/",m=c.protocol()+"://"+c.host()+":"+c.port()+"/";"server"===c.host()&&(m=l),k.checkToken=f,k.isLoggedIn=g,k.loggedIn=!1,k.login=h,k.loginProgress=!1,k.logout=i,k.name=null,k.openMenu=j,k.registerView=!1,k.reload=!0,k.role=null,k.stop=!1}function RegisterController(a,b,c){function d(b){h.registerView?(h.registerView=!1,a.path("/login")):(h.registerView=!0,a.path("/register")),f(b)}function e(d){if(void 0!==h.user.email&&void 0!==h.user.password&&void 0!==h.user.name&&void 0!==h.user.lname&&void 0!==h.user.gender){var e={};h.registeringUser=!0,void 0!==h.user.role?h.user.role="owner":h.user.role="user",b.registerUser(h.user).then(function(b){b===!0?(h.registered=!0,h.registeringUser=!1,h.registerView=!1,a.path("/login"),e={title:"¡Bienvenido!",text:"Su cuenta se ha creado correctamente.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d)):(h.registered=!1,h.registeringUser=!1,e={title:"¡Cuenta existente!",text:"No se ha podido crear su cuenta. El email "+h.user.email+" ya está registrado.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d))})}}function f(a){void 0!==a&&(a.$setPristine(),a.$setUntouched(),h.user={})}function g(){var b=a.path();"/register"===b?h.registerView=!0:"login"===b&&(a.path("/login"),h.registerView=!1)}var h=this;h.changeView=d,h.register=e,h.registered=!0,h.registerView=!1,h.registeringUser=!1,h.resetForm=f,h.selectView=g,g()}function registerUserService(a){function b(b){function c(a){return!0}function e(a){return a.data.errors[0].message}var f={name:b.name,lname:b.lname,email:b.email,pass:b.password,gender:b.gender,role:b.role};return a.post(d+"/users/new",f).then(c)["catch"](e)}var c="https://justsport-api.herokuapp.com/api",d=c,e={registerUser:b};return e}function EstablishmentDetailsController(a,b,c,d){function e(c,d,e){void 0!==d&&null!==d&&a.addComm(c,d).then(function(a){n.commentaries.push(a),b.reset(e),n.text=null})}function f(a){var b=a.indexOf("T"),c=a.slice(0,b),d=a.slice(b+1,a.indexOf(".")),e=c.slice(5,7),f=c.slice(0,4),g=c.slice(8,10),h=j(d.slice(0,2)),i=d.slice(3,5),l=d.slice(6,8);return d=h+":"+i+":"+l,e=k(e),a=g+" de "+e+" "+f+", "+d}function g(b){a.getEstablishment(b).then(function(a){"There was an error when loading establishment"===a||(n.establishment=a.Establishment,n.commentaries=a.Commentaries,n.votes=a.Votes,n.courses=a.Courses)})}function h(b,c){for(var e=0;e<n.courses.length;e++)n.courses[e].id===b&&(a.setCourse(n.courses[e]),n.course=n.courses[e]);var f="app/establishment-details/course-schedule.tmpl.html";d.showCustomDialog(c,f)}function i(a){c.getSchedule(a).then(function(a){"There are no schedules for this course"===a?n.schedule=[]:n.schedule=a})}function j(a){return a=parseInt(a),22===a?a="00":23===a?a="01":24===a?a="02":(a+=2,a=a.toString(),1===a.length&&(a="0"+a)),a}function k(a){return a="01"===a?"Enero":"02"===a?"Febrero":"03"===a?"Marzo":"04"===a?"Abril":"05"===a?"Mayo":"06"===a?"Junio":"07"===a?"Julio":"08"===a?"Agosto":"09"===a?"Septiembre":"10"===a?"Octubre":"11"===a?"Noviembre":"Diciembre"}function l(){d.hideDialog()}function m(){n.establishment=null,n.commentaries=[],n.votes=0,n.courses=[]}var n=this,o="https://justsport-api.herokuapp.com/",p=o;n.addCommentary=e,n.commentaries=[],n.course=a.getCourse(),n.courses=[],n.establishment=null,n.formatDate=f,n.getCourse=h,n.getEstablishment=g,n.getHour=j,n.getMonth=k,n.getSchedule=i,n.hideSchedule=l,n.imgFolder=p+"public/images/users/",n.removeEstab=m,n.schedule=[],n.votes=0}function establishmentDetailsService(a,b){function c(a,c){function d(a){return a.data.Commentary}function e(a){var b={message:"Something failed"};return b}var f={text:c};return b({method:"POST",url:i+"/establishments/"+a+"/commentaries/new",headers:{Authorization:"Bearer "+localStorage.token},data:f}).then(d)["catch"](e)}function d(){return j}function e(a){function b(a){var b={Establishment:{id:a.id,name:a.name,desc:a.desc,city:a.city,province:a.province,addr:a.addr,phone:a.phone,website:a.website,main_img:a.main_img},Votes:a.Votes.length,Commentaries:a.Commentaries,Courses:a.Courses};return b}function c(a){var b={message:"There was an error when loading establishment"};return b}return k.get({id:a}).$promise.then(b)["catch"](c)}function f(a){j=a}function g(a){function b(){return!0}function c(){return!1}return k.vote({id:a}).$promise.then(b)["catch"](c)}var h="https://justsport-api.herokuapp.com/api",i=h,j=null,k=a(i+"/establishments/:id",{id:"@id"},{query:{isArray:!1,method:"GET"},vote:{method:"POST",url:i+"/establishments/:id/votes/new",headers:{Authorization:"Bearer "+localStorage.token}}}),l={addComm:c,getCourse:d,getEstablishment:e,setCourse:f,vote:g};return l}function establishmentDetails(){var a={templateUrl:"app/establishment-details/est-details.html",restrict:"E"};return a}function establishmentVote(a,b){function c(c,d,e,f,g){d.on("click",function(){if(void 0!==localStorage.token){var c=parseInt(e.id.substr(5,6));a.vote(c).then(function(a){if(a){var c=parseInt($(".like-cnt").text())+1;$(".like-cnt").text(c)}else{var d={title:"¡Votación ya realizada!",text:"No puedes votar más de una vez el mismo establecimiento",aria:"Vote User Alert",textButton:"Listo"};b.showDialog(d,g)}})}else{var d={title:"Login Requerido",text:"Para poder votar este establecimiento, primero debes loguearte.",aria:"Login User Alert",textButton:"Listo"};b.showDialog(d,g)}})}var d={restrict:"EA",link:c,controller:EstablishmentDetailsController,controllerAs:"vm",bindToController:!0};return d}function UserAccountController(a,b,c,d){function e(b,e){var f={};a.uploadImg(b).then(function(a){a&&(d.imgFolder=k+"public/images/users/"+b.name,f={title:"¡Imagen Subida!",text:"Tu nueva imagen de perfil ha sido actualizada",aria:"Updated IMG User Alert",textButton:"Listo"},c.showDialog(f,e))})}function f(b){a.closeAccount(b).then(function(a){i.closed=a})}function g(){a.getUser(i.user_id).then(function(a){void 0===a.message&&("owner"===a.role?i.account.role="Propietario":i.account.role="Usuario",i.user=a,d.imgFolder=d.imgFolder+i.user.img)})}function h(d,e,f){if(void 0!==d.pass&&void 0!==i.acc.current){var g={},h=d,j=d.role;"Usuario"===h.role?h.role="user":h.role="owner",a.updateAccount(i.user_id,h).then(function(a){a?(i.updated=!0,b.reset(e),i.account={role:j},i.acc={},g={title:"¡Información Actualizada!",text:"Tu cuenta ha sido actualizada "+i.user.name,aria:"Updated User Alert",textButton:"Listo"},c.showDialog(g,f)):(i.updated=!1,g={title:"¡Error!",text:"Se ha encontrado un error durante la actualización. Por favor, intentalo de nuevo",aria:"Updated User Error Alert",textButton:"Listo"},c.showDialog(g,f))})}}var i=this,j="https://justsport-api.herokuapp.com/",k=j;i.account={},i.closeAccount=f,i.closed=!1,i.getUser=g,d.imgFolder=k+"public/images/users/",i.updateAccount=h,i.uploadImg=e,i.updated=!1,i.user={},i.user_id=localStorage.user_id}function userAccountService(a,b){function c(a){function b(){return!0}function c(){return!1}return i["delete"]({id:a}).$promise.then(b)["catch"](c)}function d(a){function b(a){var b={name:a.name,lname:a.lname,role:a.role,gender:a.gender,img:a.img};return b}function c(a){var b={message:"An error occurred"};return b}return i.get({id:a}).$promise.then(b)["catch"](c)}function e(a,b){function c(){return!0}function d(a){return!1}return i.update({id:a},b).$promise.then(c)["catch"](d)}function f(a){function c(){return!0}function d(a){return console.log(a),!1}console.log(a);var e=new FormData;return e.append("user_profile",a),b({method:"PUT",url:h+"/users/me/profile/image",data:e,headers:{Authorization:"Bearer "+localStorage.token,"Content-Type":void 0}}).then(c)["catch"](d)}var g="https://justsport-api.herokuapp.com/api",h=g,i=a(h+"/users/:id",{id:"@id"},{query:{isArray:!1,method:"GET"},"delete":{method:"DELETE",url:h+"/users/:id",headers:{Authorization:"Bearer "+localStorage.token}},update:{method:"PUT",url:h+"/users/:id",headers:{Authorization:"Bearer "+localStorage.token}}}),j={closeAccount:c,getUser:d,updateAccount:e,uploadImg:f};return j}function uploadBtn(){function a(a,b,c,d,e){var f=$("#fileInput");$("#userProfileImg");b.on("click",function(){f.click(),f.bind("change",function(){if(f.get(0).files.length>0){var a=f.get(0).files[0];d.uploadImg(a,e)}})})}var b={estrict:"EA",link:a,controller:UserAccountController,controllerAs:"vm",bindToController:!0};return b}function formResetService(){function a(a){void 0!==a&&(a.$setPristine(),a.$setUntouched())}var b={reset:a};return b}function dialogService(a){function b(){a.cancel()}function c(b,c){a.show(a.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(b.title).textContent(b.text).ariaLabel(b.aria).ok(b.textButton).targetEvent(c))}function d(b,c){a.show({templateUrl:c,parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0})}var e={hideDialog:b,showCustomDialog:d,showDialog:c};return e}angular.module("sportModule",["ngResource"]),angular.module("sportModule").controller("SportListController",SportListController),SportListController.$inject=["sportListService","establishmentFilteredService"],angular.module("sportModule").factory("sportListService",sportListService),sportListService.$inject=["$resource"],angular.module("homeModule",[]),angular.module("homeModule").directive("scrollTo",scrollTo),angular.module("homeModule").directive("filteredResults",filteredResults),angular.module("homeModule").factory("establishmentFilteredService",establishmentFilteredService),establishmentFilteredService.$inject=["$resource"],angular.module("homeModule").factory("getScheduleService",getScheduleService),getScheduleService.$inject=["$resource"],angular.module("homeModule").factory("citySuggestionsService",citySuggestionsService),citySuggestionsService.$inject=["$http"],angular.module("homeModule").controller("HomeController",HomeController),HomeController.$inject=["citySuggestionsService","$http"],angular.module("homeModule").controller("ShowScheduleController",ShowScheduleController),ShowScheduleController.$inject=["getScheduleService","dialogService","$mdDialog"],angular.module("homeModule").controller("EstablishmentFilteredController",EstablishmentFilteredController),EstablishmentFilteredController.$inject=["establishmentFilteredService","dialogService","getScheduleService"],angular.module("loginModule",[]),angular.module("loginModule").factory("loginService",loginService),loginService.$inject=["$http"],angular.module("loginModule").controller("LoginController",LoginController),LoginController.$inject=["loginService","$window","$location","dialogService","$mdSidenav"],angular.module("registerModule",[]),angular.module("registerModule").controller("RegisterController",RegisterController),RegisterController.$inject=["$location","registerUserService","dialogService"],angular.module("registerModule").factory("registerUserService",registerUserService),registerUserService.$inject=["$http"],angular.module("establishmentModule",[]),angular.module("establishmentModule").controller("EstablishmentDetailsController",EstablishmentDetailsController),EstablishmentDetailsController.$inject=["establishmentDetailsService","formResetService","getScheduleService","dialogService"],angular.module("establishmentModule").factory("establishmentDetailsService",establishmentDetailsService),establishmentDetailsService.$inject=["$resource","$http"],angular.module("establishmentModule").directive("establishmentDetails",establishmentDetails),angular.module("establishmentModule").directive("establishmentVote",establishmentVote),establishmentVote.$inject=["establishmentDetailsService","dialogService"],angular.module("userAccountModule",[]),angular.module("userAccountModule").controller("UserAccountController",UserAccountController),UserAccountController.$inject=["userAccountService","formResetService","dialogService","$scope"],angular.module("userAccountModule").factory("userAccountService",userAccountService),userAccountService.$inject=["$resource","$http"],angular.module("userAccountModule").directive("uploadBtn",uploadBtn),function(){"use strict";angular.module("justSport",["ngMaterial","ngMessages","homeModule","sportModule","loginModule","registerModule","establishmentModule","userAccountModule"]).config(["$mdThemingProvider",function(a){var b={50:"#65acf3",100:"#4d9ff1",200:"#3692ef",300:"#1e85ed",400:"#1279e0",500:"#106CC8",600:"#0e5fb0",700:"#0c5299",800:"#0a4681",900:"#08396a",A100:"#7cb8f5",A200:"#94c5f6",A400:"#acd2f8",A700:"#072c52",contrastDefaultColor:"light"};a.definePalette("customPrimary",b),a.theme("default").primaryPalette("customPrimary")}])}(),angular.module("justSport").factory("formResetService",formResetService),angular.module("justSport").factory("dialogService",dialogService),dialogService.$inject=["$mdDialog"];