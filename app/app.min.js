function SportListController(a,b){function c(){a.getSports().then(function(a){for(var c="",d=0;d<a.count;d++)c+=d+1<a.count?a.rows[d].name+", ":a.rows[d].name;return b.setIndexes(a),c.split(/, +/g).map(function(a){var b={value:a.toLowerCase(),display:a};return f.sports.push(b)})})}function d(a){var b=a?f.sports.filter(e(a)):f.sports;return b}function e(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}}var f=this;f.loadAll=c,f.querySearch=d,f.selectedItem=null,f.searchText=null,f.sports=[],c()}function sportListService(a,b){function c(){function a(a){return a.Sports}function b(a){console.log(a)}return f.get({limit:100}).$promise.then(a)["catch"](b)}var d="https://justsport-api.herokuapp.com/api",e=d,f=a(e+"/sports/:id",{id:"@id"},{query:{isArray:!1,method:"GET"}}),g={getSports:c};return g}function scrollTo(){function a(a,b,c){var d=$("#scroll");b.on("click",function(){$("body").animate({scrollTop:d.offset().top},"slow")})}var b={link:a,restrict:"A"};return b}function filteredResults(){var a={templateUrl:"app/home/est-results.html",restrict:"E"};return a}function establishmentFilteredService(a){function b(a,b,c){function d(a){return a}function e(a){return a.data.message}return"none"===c&&(c=void 0),h.get({id:a,location:b,after:c}).$promise.then(d)["catch"](e)}function c(a){return e.get(a)}function d(a){for(var b=0;b<a.rows.length;b++)e.set(a.rows[b].name,a.rows[b].id)}var e=new Map,f="https://justsport-api.herokuapp.com/api",g=f,h=a(g+"/establishments/sport/:id/location/:location",{id:"@id",location:"@location"},{query:{isArray:!1,method:"GET"}}),i={getEstablishments:b,getIndexOf:c,setIndexes:d};return i}function citySuggestionsService(a){function b(b){return a.get(d+"/establishments/"+b+"/suggestions").then(function(a){return a.data.locations})}var c="https://justsport-api.herokuapp.com/api",d=c,e={getCities:b};return e}function HomeController(a,b){function c(b){return a.getCities(b).then(function(a){return a})}var d=this;d.querySearch=c}function EstablishmentFilteredController(a,b,c){function d(b){h.activated=!1,h.prevLocation==h.location&&h.prevSport==h.sport||(h.items=[],h.after="none"),a.getEstablishments(h.sport,h.location,h.after).then(angular.bind(this,function(a){"There no more rows to retrieve"===a?h.activated=!0:"There are no establishments that match the current filter"===a?(h.activated=!0,c.show(c.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("¡Sin resultados!").textContent("No se han encontrado establecimientos para la búsqueda introducida.").ariaLabel("Alert Dialog Demo").ok("Listo").targetEvent(b))):(h.activated=!0,h.after=a.paging.cursors.after,h.items=h.items.concat(a.Establishments.rows),h.prevLocation=h.location,h.prevSport=h.sport)}))}function e(b){void 0!==b&&(h.sport=a.getIndexOf(b.display))}function f(a){void 0!==a&&(h.location=a)}function g(a){var b=a;return a.length>200&&(b=a.slice(0,200),b+="."!=b[199]?"...":".."),b}var h=this,i="https://justsport-api.herokuapp.com/",j=i;h.activated=!0,h.after="none",h.fetchMore=d,h.imgFolder=j+"public/images/ests/",h.items=[],h.location=null,h.prevLocation=null,h.prevSport=null,h.selectedItemChange=e,h.selectedLocationChange=f,h.shortenDesc=g,h.sport=null}function loginService(a){function b(b,c){function e(a){return a.data}function g(a){return a.data}var h={username:b,password:c,grant_type:"password",client_id:d};return a.post(f+"/oauth2/token",h).then(e)["catch"](g)}function c(){return void 0!==localStorage.username}var d="2xa001za-78b3-4f38-9376-e2dd88b7c682",e="https://justsport-api.herokuapp.com/api",f=e,g={getToken:b,isLoggedIn:c};return g}function LoginController(a,b,c,d,e){function f(){return!(localStorage.expires<=Date.now())}function g(){a.isLoggedIn()&&(j.loggedIn=!0,j.name=localStorage.username,j.role=localStorage.role)}function h(c,f,g){void 0!==c&&void 0!==f&&(j.loginProgress=!0,a.getToken(c,f).then(function(a){if(a.error){j.loginProgress=!1;var c={title:"Login incorrecto",text:"El email o la contraseña introducidos, no son correctos.",aria:"Login User Alert",textButton:"Listo"};e.showDialog(c,g)}else localStorage.setItem("token",a.access_token),localStorage.setItem("username",a.username),localStorage.setItem("role",a.role),localStorage.setItem("user_id",a.user_id),localStorage.setItem("expires",a.expires),j.loggedIn=!0,j.name=a.username,j.role=a.role,d.post(l+"token/"+a.access_token).then(function(a){b.location.href=l})}))}function i(){j.loggedIn=!1,j.name=null,j.role=null,localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("user_id"),localStorage.removeItem("expires"),d["delete"](l+"token")}var j=this,k="https://justsport-api.herokuapp.com/api/",l=c.protocol()+"://"+c.host()+":"+c.port()+"/";"server"===c.host()&&(l=k),j.checkToken=f,j.isLoggedIn=g,j.loggedIn=!1,j.login=h,j.loginProgress=!1,j.logout=i,j.name=null,j.role=null,g()}function RegisterController(a,b,c){function d(b){h.registerView?(h.registerView=!1,a.path("/login")):(h.registerView=!0,a.path("/register")),f(b)}function e(d){var e={};void 0!==h.user&&(h.registeringUser=!0,void 0!==h.user.role?h.user.role="owner":h.user.role="user",b.registerUser(h.user).then(function(b){b===!0?(h.registered=!0,h.registeringUser=!1,h.registerView=!1,a.path("/login"),e={title:"¡Bienvenido!",text:"Su cuenta se ha creado correctamente.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d)):(h.registered=!1,h.registeringUser=!1,e={title:"¡Cuenta existente!",text:"No se ha podido crear su cuenta. El email "+h.user.email+" ya está registrado.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d))}))}function f(a){void 0!==a&&(a.$setPristine(),a.$setUntouched(),h.user={})}function g(){var b=a.path();"/register"===b?h.registerView=!0:""===b?a.path("/login"):h.registerView=!1}var h=this;h.changeView=d,h.register=e,h.registered=!0,h.registerView=!1,h.registeringUser=!1,h.resetForm=f,h.selectView=g,g()}function registerUserService(a){function b(b){function c(a){return!0}function e(a){return a.data.errors[0].message}var f={name:b.name,lname:b.lname,email:b.email,pass:b.password,gender:b.gender,role:b.role};return a.post(d+"/users/new",f).then(c)["catch"](e)}var c="https://justsport-api.herokuapp.com/api",d=c,e={registerUser:b};return e}function dialogService(a){function b(b,c){a.show(a.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(b.title).textContent(b.text).ariaLabel(b.aria).ok(b.textButton).targetEvent(c))}var c={showDialog:b};return c}angular.module("sportModule",["ngResource"]),angular.module("sportModule").controller("SportListController",SportListController),SportListController.$inject=["sportListService","establishmentFilteredService"],angular.module("sportModule").factory("sportListService",sportListService),sportListService.$inject=["$resource"],angular.module("homeModule",[]),angular.module("homeModule").directive("scrollTo",scrollTo),angular.module("homeModule").directive("filteredResults",filteredResults),angular.module("homeModule").factory("establishmentFilteredService",establishmentFilteredService),establishmentFilteredService.$inject=["$resource"],angular.module("homeModule").factory("citySuggestionsService",citySuggestionsService),citySuggestionsService.$inject=["$http"],angular.module("homeModule").controller("HomeController",HomeController),HomeController.$inject=["citySuggestionsService","$http"],angular.module("homeModule").controller("EstablishmentFilteredController",EstablishmentFilteredController),EstablishmentFilteredController.$inject=["establishmentFilteredService","$mdToast","$mdDialog"],angular.module("loginModule",[]),angular.module("loginModule").factory("loginService",loginService),loginService.$inject=["$http"],angular.module("loginModule").controller("LoginController",LoginController),LoginController.$inject=["loginService","$window","$location","$http","dialogService"],angular.module("registerModule",[]),angular.module("registerModule").controller("RegisterController",RegisterController),RegisterController.$inject=["$location","registerUserService","dialogService"],angular.module("registerModule").factory("registerUserService",registerUserService),registerUserService.$inject=["$http"],function(){"use strict";angular.module("justSport",["ngMaterial","ngMessages","homeModule","sportModule","loginModule","registerModule"]).config(["$mdThemingProvider",function(a){var b={50:"#65acf3",100:"#4d9ff1",200:"#3692ef",300:"#1e85ed",400:"#1279e0",500:"#106CC8",600:"#0e5fb0",700:"#0c5299",800:"#0a4681",900:"#08396a",A100:"#7cb8f5",A200:"#94c5f6",A400:"#acd2f8",A700:"#072c52",contrastDefaultColor:"light"};a.definePalette("customPrimary",b),a.theme("default").primaryPalette("customPrimary")}])}(),angular.module("justSport").factory("dialogService",dialogService),dialogService.$inject=["$mdDialog"];