function SportListController(a,b){function c(){a.getSports().then(function(a){for(var c="",d=0;d<a.count;d++)c+=d+1<a.count?a.rows[d].name+", ":a.rows[d].name;return b.setIndexes(a),c.split(/, +/g).map(function(a){var b={value:a.toLowerCase(),display:a};return f.sports.push(b)})})}function d(a){var b=a?f.sports.filter(e(a)):f.sports;return b}function e(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}}var f=this;f.loadAll=c,f.querySearch=d,f.selectedItem=null,f.searchText=null,f.sports=[],c()}function sportListService(a,b){function c(){function a(a){return a.Sports}function b(a){console.log(a)}return f.get({limit:100}).$promise.then(a)["catch"](b)}var d="https://localhost:3000/api",e=d,f=a(e+"/sports/:id",{id:"@id"},{query:{isArray:!1,method:"GET"}}),g={getSports:c};return g}function scrollTo(){function a(a,b,c){var d=$("#scroll"),e=$("#results");b.on("click",function(){"scrollResults"==c.id?$("body").animate({scrollTop:e.offset().top},"slow"):$("body").animate({scrollTop:d.offset().top},"slow")})}var b={link:a,restrict:"A"};return b}function filteredResults(){var a={templateUrl:"app/home/est-results.html",restrict:"E"};return a}function establishmentFilteredService(a){function b(a,b,c){function d(a){return a}function e(a){return a.data.message}return"none"===c&&(c=void 0),h.get({id:a,location:b,after:c}).$promise.then(d)["catch"](e)}function c(a){return e.get(a)}function d(a){for(var b=0;b<a.rows.length;b++)e.set(a.rows[b].name,a.rows[b].id)}var e=new Map,f="https://localhost:3000/api",g=f,h=a(g+"/establishments/sport/:id/location/:location",{id:"@id",location:"@location"},{query:{isArray:!1,method:"GET"}}),i={getEstablishments:b,getIndexOf:c,setIndexes:d};return i}function getScheduleService(a){function b(a){function b(a){var b={sportId:a.Sport.id,establishmentId:a.Establishment.id,instructor:a.instructor,price:a.price,info:a.info};return b}function c(a){return a.data.message}return m.get({id:a}).$promise.then(b)["catch"](c)}function c(){return l}function d(a,b){function c(a){return a.Schedule.rows}function d(a){return a.data.message}return m.fullSchedule({id:a,sport:b}).$promise.then(c)["catch"](d)}function e(a){function b(a){return a.Schedule.rows}function c(a){return a.data.message}return m.schedule({id:a}).$promise.then(b)["catch"](c)}function f(){return k}function g(a){l=a}function h(a){k=a}var i="https://localhost:3000/api",j=i,k=null,l=null,m=a(j+"/courses/:id",{id:"@id"},{schedule:{method:"GET",url:j+"/courses/:id/schedule",isArray:!1},fullSchedule:{method:"GET",url:j+"/establishments/:id/sport/:sport/schedule",isArray:!1}}),n={getCourse:b,getEstab:c,getFullSchedule:d,getSchedule:e,getSport:f,setEstab:g,setSport:h};return n}function citySuggestionsService(a){function b(b){return a.get(d+"/establishments/"+b+"/suggestions").then(function(a){return a.data.locations})}var c="https://localhost:3000/api",d=c,e={getCities:b};return e}function HomeController(a,b){function c(b){return a.getCities(b).then(function(a){return a})}var d=this;d.querySearch=c}function ShowScheduleController(a,b,c){function d(){i.course=null}function e(b){a.getCourse(b).then(function(a){void 0!==a.info&&(i.course=a)})}function f(b,c){a.getFullSchedule(b,c).then(function(a){"There is no schedule established yet"!==a?(i.schedule=a,i.timetable=i.schedule):(i.schedule=null,i.timetable=i.schedule)})}function g(){c.cancel()}function h(c,d){var e="app/home/est-schedule.tmpl.html";a.setEstab(d),b.showCustomDialog(c,e)}var i=this;i.backToSchedule=d,i.course=null,i.estab=a.getEstab(),i.sport=a.getSport(),i.getCourse=e,i.getSchedule=f,i.hideSchedule=g,i.schedule=null,i.showSchedule=h,i.timetable=null}function EstablishmentFilteredController(a,b,c){function d(d){var e={};h.activated=!1,h.prevLocation==h.location&&h.prevSport==h.sport||(h.items=[],h.after="none"),a.getEstablishments(h.sport,h.location,h.after).then(angular.bind(this,function(a){"There no more rows to retrieve"===a?h.activated=!0:"There are no establishments that match the current filter"===a?(h.activated=!0,e={title:"Sin resultados",text:"No se han encontrado establecimientos para la búsqueda introducida.",aria:"Establishment Dialog",textButton:"Listo"},b.showDialog(e,d)):(c.setSport(h.sport),h.activated=!0,h.after=a.paging.cursors.after,h.items=h.items.concat(a.Establishments.rows),h.prevLocation=h.location,h.prevSport=h.sport)}))}function e(b){void 0!==b&&(h.sport=a.getIndexOf(b.display))}function f(a){void 0!==a&&(h.location=a)}function g(a){var b=a;return a.length>200&&(b=a.slice(0,200),b+="."!=b[199]?"...":".."),b}var h=this,i="https://localhost:3000/",j=i;h.activated=!0,h.after="none",h.fetchMore=d,h.imgFolder=j+"public/images/ests/",h.items=[],h.location=null,h.prevLocation=null,h.prevSport=null,h.selectedItemChange=e,h.selectedLocationChange=f,h.shortenDesc=g,h.sport=null}function loginService(a){function b(b,c){function e(a){return a.data}function g(a){return a.data}var h={username:b,password:c,grant_type:"password",client_id:d};return a.post(f+"/oauth2/token",h).then(e)["catch"](g)}function c(){return void 0!==localStorage.username}var d="2xa001za-78b3-4f38-9376-e2dd88b7c682",e="https://localhost:3000/api",f=e,g={getToken:b,isLoggedIn:c};return g}function LoginController(a,b,c,d,e){function f(){return!(localStorage.expires<=Date.now())}function g(){a.isLoggedIn()&&(j.loggedIn=!0,j.name=localStorage.username,j.role=localStorage.role)}function h(c,f,g){void 0!==c&&void 0!==f&&(j.loginProgress=!0,a.getToken(c,f).then(function(a){if(a.error){j.loginProgress=!1;var c={title:"Login incorrecto",text:"El email o la contraseña introducidos, no son correctos.",aria:"Login User Alert",textButton:"Listo"};e.showDialog(c,g)}else localStorage.setItem("token",a.access_token),localStorage.setItem("username",a.username),localStorage.setItem("role",a.role),localStorage.setItem("user_id",a.user_id),localStorage.setItem("expires",a.expires),j.loggedIn=!0,j.name=a.username,j.role=a.role,d.post(l+"token/"+a.access_token).then(function(a){b.location.href=l})}))}function i(){j.loggedIn=!1,j.name=null,j.role=null,localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("user_id"),localStorage.removeItem("expires"),d["delete"](l+"token")}var j=this,k="https://localhost:3000/api/",l=c.protocol()+"://"+c.host()+":"+c.port()+"/";"server"===c.host()&&(l=k),j.checkToken=f,j.isLoggedIn=g,j.loggedIn=!1,j.login=h,j.loginProgress=!1,j.logout=i,j.name=null,j.role=null,g()}function RegisterController(a,b,c){function d(b){h.registerView?(h.registerView=!1,a.path("/login")):(h.registerView=!0,a.path("/register")),f(b)}function e(d){var e={};void 0!==h.user&&(h.registeringUser=!0,void 0!==h.user.role?h.user.role="owner":h.user.role="user",b.registerUser(h.user).then(function(b){b===!0?(h.registered=!0,h.registeringUser=!1,h.registerView=!1,a.path("/login"),e={title:"¡Bienvenido!",text:"Su cuenta se ha creado correctamente.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d)):(h.registered=!1,h.registeringUser=!1,e={title:"¡Cuenta existente!",text:"No se ha podido crear su cuenta. El email "+h.user.email+" ya está registrado.",aria:"Registered User Alert",textButton:"Listo"},c.showDialog(e,d))}))}function f(a){void 0!==a&&(a.$setPristine(),a.$setUntouched(),h.user={})}function g(){var b=a.path();"/register"===b?h.registerView=!0:""===b?a.path("/login"):h.registerView=!1}var h=this;h.changeView=d,h.register=e,h.registered=!0,h.registerView=!1,h.registeringUser=!1,h.resetForm=f,h.selectView=g,g()}function registerUserService(a){function b(b){function c(a){return!0}function e(a){return a.data.errors[0].message}var f={name:b.name,lname:b.lname,email:b.email,pass:b.password,gender:b.gender,role:b.role};return a.post(d+"/users/new",f).then(c)["catch"](e)}var c="https://localhost:3000/api",d=c,e={registerUser:b};return e}function EstablishmentDetailsController(a,b){function c(b){a.getEstablishment(b).then(function(a){"There was an error when loading establishment"===a||(h.establishment=a.Establishment,h.commentaries=a.Commentaries,h.votes=a.Votes,h.courses=a.Courses)})}function d(a){return a=parseInt(a),22===a?a="00":23===a?a="01":24===a?a="02":(a+=2,a=a.toString(),1===a.length&&(a="0"+a)),a}function e(a){return a="01"===a?"Enero":"02"===a?"Febrero":"03"===a?"Marzo":"04"===a?"Abril":"05"===a?"Mayo":"06"===a?"Junio":"07"===a?"Julio":"08"===a?"Agosto":"09"===a?"Septiembre":"10"===a?"Octubre":"11"===a?"Noviembre":"Diciembre"}function f(a){var b=a.indexOf("T"),c=a.slice(0,b),f=a.slice(b+1,a.indexOf(".")),g=c.slice(5,7),h=c.slice(0,4),i=c.slice(8,10),j=d(f.slice(0,2)),k=f.slice(3,5),l=f.slice(6,8);return f=j+":"+k+":"+l,g=e(g),a=i+" de "+g+" "+h+", "+f}function g(){h.establishment=null,h.commentaries=[],h.votes=0,h.courses=[]}var h=this,i="https://localhost:3000/",j=i;h.commentaries=[],h.courses=[],h.establishment=null,h.formatDate=f,h.getEstablishment=c,h.getHour=d,h.getMonth=e,h.imgFolder=j+"public/images/users/",h.removeEstab=g,h.votes=0}function establishmentDetailsService(a){function b(a){function b(a){var b={Establishment:{id:a.id,name:a.name,desc:a.desc,city:a.city,province:a.province,addr:a.addr,phone:a.phone,website:a.website,main_img:a.main_img},Votes:a.Votes.length,Commentaries:a.Commentaries,Courses:a.Courses};return b}function c(a){var b={message:"There was an error when loading establishment"};return b}return f.get({id:a}).$promise.then(b)["catch"](c)}function c(a){function b(){return!0}function c(){return!1}return f.vote({id:a}).$promise.then(b)["catch"](c)}var d="https://localhost:3000/api",e=d,f=a(e+"/establishments/:id",{id:"@id"},{query:{isArray:!1,method:"GET"},vote:{method:"POST",url:e+"/establishments/:id/votes/new",headers:{Authorization:"Bearer "+localStorage.token}}}),g={getEstablishment:b,vote:c};return g}function establishmentDetails(){var a={templateUrl:"app/establishment-details/est-details.html",restrict:"E"};return a}function establishmentVote(a,b){function c(c,d,e,f,g){d.on("click",function(){if(void 0!==localStorage.token){var c=parseInt(e.id.substr(5,6));a.vote(c).then(function(a){if(a){var c=parseInt($(".like-cnt").text())+1;$(".like-cnt").text(c)}else{var d={title:"¡Votación ya realizada!",text:"No puedes votar más de una vez el mismo establecimiento",aria:"Vote User Alert",textButton:"Listo"};b.showDialog(d,g)}})}else{var d={title:"Login Requerido",text:"Para poder votar este establecimiento, primero debes loguearte.",aria:"Login User Alert",textButton:"Listo"};b.showDialog(d,g)}})}var d={restrict:"EA",link:c,controller:EstablishmentDetailsController,controllerAs:"vm",bindToController:!0};return d}function dialogService(a){function b(b,c){a.show(a.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(b.title).textContent(b.text).ariaLabel(b.aria).ok(b.textButton).targetEvent(c))}function c(b,c){a.show({templateUrl:c,parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0})}var d={showCustomDialog:c,showDialog:b};return d}function testApp(a){var b="https://localhost:3000/api",c={locations:["Alicante"]},d={locations:["Valencia"]};a.whenGET(b+"/establishments/Valencia/suggestions").respond(d),a.whenGET(b+"/establishments/Alicante/suggestions").respond(c)}function sportTest(a){var b="https://localhost:3000/api",c={rows:[{id:1,name:"Spinning"},{id:2,name:"GAP"},{id:3,name:"BodyJump"},{id:4,name:"Pilates"},{id:5,name:"CrossFit"}],count:5},d={Sports:c};a.whenGET(b+"/sports?limit=100").respond(d)}function estabsFilteredTest(a){var b="https://localhost:3000/api",c={message:"There are no establishments that match the current filter"};a.whenGET(b+"/establishments/sport/1/location/Valencia").respond(404,c);var d={id:1,name:"Gym A Tope",desc:"Gimnasio perfecto para realizar tus actividades deportivas.",city:"San Vicente del Raspeig",province:"Alicante",addr:"Calle San Franciso nº15",phone:"965660327",website:"http://wwww.gymatope.es",main_img:"default.jpg"},e={id:2,name:"Gym Noray",desc:"Gimnasio muy acondicionado y en perfecto estado.",city:"Santa Pola",province:"Alicante",addr:"Calle Falsa nº34",phone:"965662347",website:"http://wwww.noraygym.com",main_img:"default.jpg"},f={id:4,name:"Montemar",desc:"Especializados en cursos y clases de ténis.",city:"Alicante",province:"Alicante",addr:"Avenida Novelda Km 14",phone:"965662268",website:"http://wwww.montemar.es",main_img:"default.jpg"},g={count:3,rows:[d,e,f]},h={before:0,after:0},i={cursors:h,previous:"none",next:"none"},j={Establishments:g,paging:i};a.whenGET(b+"/establishments/sport/1/location/Alicante").respond(j),a.whenGET("app/home/est-results.html").passThrough()}function loginTest(a){var b="https://localhost:3000",c={access_token:"eyJ0",role:"owner",username:"Pepe",expires:1460805614894},d={error:"Faking error"};a.whenPOST(b+"/api/oauth2/token").respond(function(a,b,e){var f=angular.fromJson(e);return"pepe@gmail.com"===f.username?[200,c,{}]:[401,d,{}]}),a.whenPOST("https://localhost:5000/token/eyJ0").passThrough(),a.whenPOST("http://localhost:5000/token/eyJ0").passThrough(),a.whenDELETE("https://localhost:5000/token").passThrough(),a.whenDELETE("http://localhost:5000/token").passThrough()}function registerTest(a){var b="https://localhost:3000",c={errors:[{type:"Duplicated entry",field:"email",message:"The value: 'pepe@gmail.com' is already taken"}]};a.whenPOST(b+"/api/users/new").respond(function(a,b,d){var e=angular.fromJson(d);return"pepe@gmail.com"===e.email?[500,c,{}]:[201]})}function showScheduleTest(a){var b="https://localhost:3000/api",c={day:"Martes",startTime:"10:00",endTime:"11:00",courseId:1},d={day:"Lunes",startTime:"11:00",endTime:"12:00",courseId:1},e={day:"Miércoles",startTime:"17:00",endTime:"18:00",courseId:1},f={day:"Jueves",startTime:"20:00",endTime:"21:00",courseId:1},g={day:"Jueves",startTime:"12:00",endTime:"13:00",courseId:1},h={day:"Viernes",startTime:"09:00",endTime:"10:00",courseId:1},i={Schedule:{count:6,rows:[c,d,e,g,f,h]}},j={Sport:{id:"1"},Establishment:{id:"1"},instructor:"Juan Domínguez",price:"17.50",info:"Un curso muy completo"},k={message:"There is no schedule established yet"};a.whenGET(b+"/establishments/1/sport/1/schedule").respond(i),a.whenGET(b+"/courses/1").respond(j),a.whenGET(b+"/establishments/2/sport/1/schedule").respond(k),a.whenGET("app/home/est-schedule.tmpl.html").passThrough()}angular.module("sportModule",["ngResource"]),angular.module("sportModule").controller("SportListController",SportListController),SportListController.$inject=["sportListService","establishmentFilteredService"],angular.module("sportModule").factory("sportListService",sportListService),sportListService.$inject=["$resource"],angular.module("homeModule",[]),angular.module("homeModule").directive("scrollTo",scrollTo),angular.module("homeModule").directive("filteredResults",filteredResults),angular.module("homeModule").factory("establishmentFilteredService",establishmentFilteredService),establishmentFilteredService.$inject=["$resource"],angular.module("homeModule").factory("getScheduleService",getScheduleService),getScheduleService.$inject=["$resource"],angular.module("homeModule").factory("citySuggestionsService",citySuggestionsService),citySuggestionsService.$inject=["$http"],angular.module("homeModule").controller("HomeController",HomeController),HomeController.$inject=["citySuggestionsService","$http"],angular.module("homeModule").controller("ShowScheduleController",ShowScheduleController),ShowScheduleController.$inject=["getScheduleService","dialogService","$mdDialog"],angular.module("homeModule").controller("EstablishmentFilteredController",EstablishmentFilteredController),EstablishmentFilteredController.$inject=["establishmentFilteredService","dialogService","getScheduleService"],angular.module("loginModule",[]),angular.module("loginModule").factory("loginService",loginService),loginService.$inject=["$http"],angular.module("loginModule").controller("LoginController",LoginController),LoginController.$inject=["loginService","$window","$location","$http","dialogService"],angular.module("registerModule",[]),angular.module("registerModule").controller("RegisterController",RegisterController),RegisterController.$inject=["$location","registerUserService","dialogService"],angular.module("registerModule").factory("registerUserService",registerUserService),registerUserService.$inject=["$http"],angular.module("establishmentModule",[]),angular.module("establishmentModule").controller("EstablishmentDetailsController",EstablishmentDetailsController),EstablishmentDetailsController.$inject=["establishmentDetailsService","dialogService"],angular.module("establishmentModule").factory("establishmentDetailsService",establishmentDetailsService),establishmentDetailsService.$inject=["$resource"],angular.module("establishmentModule").directive("establishmentDetails",establishmentDetails),angular.module("establishmentModule").directive("establishmentVote",establishmentVote),establishmentVote.$inject=["establishmentDetailsService","dialogService"],function(){"use strict";angular.module("justSport",["ngMaterial","ngMessages","homeModule","sportModule","loginModule","registerModule","establishmentModule"]).config(["$mdThemingProvider",function(a){var b={50:"#65acf3",100:"#4d9ff1",200:"#3692ef",300:"#1e85ed",400:"#1279e0",500:"#106CC8",600:"#0e5fb0",700:"#0c5299",800:"#0a4681",900:"#08396a",A100:"#7cb8f5",A200:"#94c5f6",A400:"#acd2f8",A700:"#072c52",contrastDefaultColor:"light"};a.definePalette("customPrimary",b),a.theme("default").primaryPalette("customPrimary")}])}(),angular.module("justSport").factory("dialogService",dialogService),dialogService.$inject=["$mdDialog"],function(){"use strict";function a(a){a.whenGET("./public/images/icons/account.svg").passThrough(),a.whenGET("public/images/icons/ic_expand_more_black_36px.svg").passThrough(),a.whenGET("public/images/icons/date.svg").passThrough(),a.whenGET("public/images/icons/info.svg").passThrough(),a.whenGET("public/images/icons/ic_close.svg").passThrough()}angular.module("justSportTest",["justSport","ngMockE2E"]).run(a),a.$inject=["$httpBackend"]}(),angular.module("justSportTest").run(testApp),testApp.$inject=["$httpBackend"],angular.module("justSportTest").run(sportTest),sportTest.$inject=["$httpBackend"],angular.module("justSportTest").run(estabsFilteredTest),estabsFilteredTest.$inject=["$httpBackend"],angular.module("justSportTest").run(loginTest),loginTest.$inject=["$httpBackend"],angular.module("justSportTest").run(registerTest),registerTest.$inject=["$httpBackend"],angular.module("justSportTest").run(showScheduleTest),showScheduleTest.$inject=["$httpBackend"];