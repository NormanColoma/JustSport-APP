<link rel="stylesheet" type="text/css" href="public/stylesheets/back-office-estabs.css">
<md-content layout="row" layout-sm="column" layout-wrap id="establishments-list-container" ng-show="backOEstVM.view == 'listEstabs'" ng-cloak>
    <div class="est-owner-container" flex="33" hide-sm hide-xs ng-repeat="item in backOEstVM.estabs">
        <md-card>
            <img ng-src="{{backOEstVM.imgFolder+item.main_img}}" class="md-card-image" alt="{{backOEstVM.imgFolder+item.main_img}}" src="{{backOEstVM.imgFolder+item.main_img}}">
            <md-card-title>
                <md-card-title-text>
                    <span class="md-headline color-primary">{{item.name}}</span>
                    <div layout="row">
                        <p class="md-body-1">{{item.city}}</p>
                    </div>
                </md-card-title-text>
            </md-card-title>
            <md-card-actions layout="row" layout-align="end center" class="layout-align-end-center layout-row">
                <md-divider></md-divider>
                <md-button class="md-icon-button md-button md-ink-ripple" type="button" aria-label="Eliminar"
                           id="delete-estab"  ng-click="estDtVm.getEstablishment(item.id)" name="{{item.id}}">
                    <md-icon md-svg-icon="public/images/icons/delete.svg" aria-hidden="true" id="est-delete-{{item.id}}"></md-icon>
                    <md-tooltip md-direction="top">
                        Eliminar {{item.name}}
                    </md-tooltip>
                </md-button>
                <md-button class="md-icon-button md-button md-ink-ripple" type="button" aria-label="Actualizar"
                           id="update-estab"  ng-click="estDtVm.getEstablishment(item.id)" name="{{item.id}}">
                    <md-icon md-svg-icon="public/images/icons/edit.svg" aria-hidden="true" id="update-{{item.id}}"></md-icon>
                    <md-tooltip md-direction="top">
                        Actualizar información
                    </md-tooltip>
                </md-button>
                <md-button class="md-icon-button md-button md-ink-ripple" type="button" aria-label="Subir Imagen perfil"
                           id="update-img-estab"  ng-click="estDtVm.getEstablishment(item.id)" name="{{item.id}}">
                    <md-icon md-svg-icon="public/images/icons/add_photo.svg" aria-hidden="true" id="update-img-{{item.id}}"></md-icon>
                    <md-tooltip md-direction="top">
                        Cambiar imagen de perfil
                    </md-tooltip>
                </md-button>
            </md-card-actions>
        </md-card>
    </div>
    <div>
        <md-button ng-show="backOEstVM.after != 'none' && backOEstVM.after != 0" class="md-raised default-button" ng-click="backOEstVM.getEstabs(ev)"
        id="fetch-more-btn">
            Ver Más
        </md-button>
    </div>
</md-content>
<md-content layout="row" layout-sm="column" layout-wrap  id="establishments-add-container" ng-show="backOEstVM.view == 'addEstab'">
    <form name="addEstabForm" novalidate layout="row" layout-wrap flex="100">
        <md-input-container class="md-block" flex="40">
            <label>Nombre del Establecimiento</label>
            <input required="" name="ename" ng-model="backOEstVM.estab.name" flex="100"
                   ng-pattern="/^([ \u00c0-\u01ffa-zA-Z-0-9'\-])+$/i"/>
            <div ng-messages="addEstabForm.ename.$error" ng-show="addEstabForm.ename.$touched || addEstabForm.$submitted">
                <div ng-message="required" class="email-message">El nombre es obligatorio.</div>
                <div ng-show="addEstabForm.ename.$error.pattern" class="input-error">El nombre no es correcto. Solo admite caracteres alfanuméricos.</div>
            </div>
        </md-input-container>
        <div flex="5"></div>
        <md-input-container class="md-block" flex="40">
            <label>Teléfono</label>
            <input required="" name="ephone" ng-model="backOEstVM.estab.phone" flex="100" type="tel"
                   ng-pattern="/^[9|6|7|8][0-9]{8}$/"/>
            <div ng-messages="addEstabForm.ephone.$error" ng-show="addEstabForm.ephone.$touched || addEstabForm.$submitted">
                <div ng-message="required" class="email-message">El teléfono es obligatorio.</div>
                <div ng-show="addEstabForm.ephone.$error.pattern" class="input-error">El teléfono no es correcto.</div>
            </div>
        </md-input-container>
        <md-autocomplete flex="40" md-selected-item="backOEstVM.selectedItem" md-search-text="backOEstVM.searchText"
                         md-items="item in backOEstVM.querySearch(backOEstVM.searchText)" md-item-text="item"
                         md-floating-label="¿En qué ciudad se encuentra el establecimiento?" md-input-name="ecity"
                         ng-model="backOEstVM.estab.city" md-search-text-change="backOEstVM.searchCityChange(backOEstVM.searchText)" required="required">
            <md-item-template><span md-highlight-text="backOEstVM.searchText" md-highlight-flags="^i">{{item}}</span></md-item-template>
            <md-not-found>No hay resultados para "{{backOEstVM.searchText}}".</md-not-found>
            <div ng-messages="addEstabForm.ecity.$error" ng-if="addEstabForm.ecity.$touched || addEstabForm.$submitted">
                <div ng-message="required" class="sport-message">Tienes que seleccionar una ciudad</div>
            </div>
        </md-autocomplete>
        <div flex="5"></div>
        <md-autocomplete flex="40" md-selected-item="backOEstVM.selectedItemProvince" md-search-text="backOEstVM.searchTextProvince"
                         md-items="item in backOEstVM.querySearch(backOEstVM.searchTextProvince)" md-item-text="item"
                         md-floating-label="¿A qué provincia pertenece la ciudad?" md-input-name="eprovince"
                         ng-model="backOEstVM.estab.province" md-search-text-change="backOEstVM.searchProvinceChange(backOEstVM.searchTextProvince)" required="required">
            <md-item-template><span md-highlight-text="backOEstVM.searchTextProvince" md-highlight-flags="^i">{{item}}</span></md-item-template>
            <md-not-found>No hay resultados para "{{backOEstVM.searchTextProvince}}".</md-not-found>
            <div ng-messages="addEstabForm.eprovince.$error" ng-if="addEstabForm.eprovince.$touched || addEstabForm.$submitted">
                <div ng-message="required" class="sport-message">Tienes que seleccionar una provincia</div>
            </div>
        </md-autocomplete>
        <md-input-container class="md-block" flex="100">
            <label>Dirección del Establecimiento</label>
            <input required="" name="eaddr" ng-model="backOEstVM.estab.addr" flex="100"/>
            <div ng-messages="addEstabForm.eaddr.$error" ng-show="addEstabForm.eaddr.$touched || addEstabForm.$submitted">
                <div ng-message="required" class="email-message">La dirección es obligatorio.</div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex="40">
            <label>¿El establecimiento tiene sitio web?</label>
            <input name="eweb" ng-model="backOEstVM.estab.website" flex="100" type="url"/>
            <div ng-messages="addEstabForm.eweb.$error" ng-show="addEstabForm.eweb.$touched || addEstabForm.$submitted">
                <div ng-show="addEstabForm.$error.url" class="input-error">La url del sitio web no es correcta.</div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex="100">
            <md-button type="submit" class="md-raised md-primary" id="add-est-btn">
                Añadir
            </md-button>
        </md-input-container>
    </form>
</md-content>