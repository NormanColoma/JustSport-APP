<md-content layout="row" layout-sm="column" layout-wrap  id="establishments-update-container" ng-hide="true" ng-show="backOEstVM.view == 'updateEstab'" ng-cloak>
    <form name="updateEstabFormM" layout="row" layout-wrap flex="100" novalidate
          ng-submit="updateEstabFormM.ename.$valid && updateEstabFormM.ephone.$valid &&
          updateEstabFormM.ecity.$valid && updateEstabFormM.eprovince.$valid && updateEstabFormM.eaddr.$valid
          && updateEstabFormM.eweb.$valid && updateEstabFormM.edesc.$valid && backOEstVM.updateEstab(backOEstVM.id,backOEstVM.selectedEst,ev,updateEstabFormM)">
        <md-input-container class="md-block" flex="40" flex-md="100" flex-xs="100">
            <label>Nombre del Establecimiento</label>
            <input required="" name="ename" ng-model="backOEstVM.selectedEst.name" flex="100"
                   ng-pattern="/^([ \u00c0-\u01ffa-zA-Z-0-9'\-])+$/i"/>
            <div ng-messages="updateEstabFormM.ename.$error" ng-show="updateEstabFormM.ename.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="rname">El nombre es obligatorio.</div>
                <div ng-show="updateEstabFormM.ename.$error.pattern" class="input-error" name="pname">El nombre no es correcto. Solo admite caracteres alfanuméricos.</div>
            </div>
        </md-input-container>
        <div flex="5"></div>
        <md-input-container class="md-block" flex="40" flex-md="100" flex-xs="100">
            <label>Teléfono</label>
            <input required="" name="ephone" ng-model="backOEstVM.selectedEst.phone" flex="100" type="tel" value="backOEstVM.selectedEst.phone"
                   ng-pattern="/^[9|6|7|8][0-9]{8}$/"/>
            <div ng-messages="updateEstabFormM.ephone.$error" ng-show="updateEstabFormM.ephone.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="rphone">El teléfono es obligatorio.</div>
                <div ng-show="updateEstabFormM.ephone.$error.pattern" class="input-error" name="pphone">El teléfono no es correcto.</div>
            </div>
        </md-input-container>
        <md-autocomplete flex="40" flex-md="100" flex-xs="100" md-selected-item="backOEstVM.selectedItem" md-search-text="backOEstVM.searchText"
                         md-items="item in backOEstVM.querySearch(backOEstVM.searchText)" md-item-text="item"
                         md-floating-label="Ciudad" md-input-name="ecity"
                         ng-model="backOEstVM.selectedEst.city" md-selected-item-change="backOEstVM.searchCityChange(backOEstVM.searchText)"
                         required="">
            <md-item-template><span md-highlight-text="backOEstVM.searchText" md-highlight-flags="^i">{{item}}</span></md-item-template>
            <md-not-found>No hay resultados para "{{backOEstVM.searchText}}".</md-not-found>
            <div ng-messages="updateEstabFormM.ecity.$error" ng-if="updateEstabFormM.ecity.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="rcity">Tienes que seleccionar una ciudad.</div>
            </div>
        </md-autocomplete>
        <div flex="5"></div>
        <md-autocomplete flex="40" flex-md="100" flex-xs="100" md-selected-item="backOEstVM.selectedItemProvince" md-search-text="backOEstVM.searchTextProvince"
                         md-items="item in backOEstVM.querySearch(backOEstVM.searchTextProvince)" md-item-text="item"
                         md-floating-label="Provincia" md-input-name="eprovince"
                         ng-model="backOEstVM.selectedEst.province" md-selected-item-change="backOEstVM.searchProvinceChange(backOEstVM.searchTextProvince)" required="">
            <md-item-template><span md-highlight-text="backOEstVM.searchTextProvince" md-highlight-flags="^i">{{item}}</span></md-item-template>
            <md-not-found>No hay resultados para "{{backOEstVM.searchTextProvince}}".</md-not-found>
            <div ng-messages="updateEstabFormM.eprovince.$error" ng-if="updateEstabFormM.eprovince.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="rprovince">Tienes que seleccionar una provincia.</div>
            </div>
        </md-autocomplete>
        <md-input-container class="md-block" flex="100">
            <label>Dirección del Establecimiento</label>
            <input required="" name="eaddr" ng-model="backOEstVM.selectedEst.addr" flex="100"/>
            <div ng-messages="updateEstabFormM.eaddr.$error" ng-show="updateEstabFormM.eaddr.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="raddr">La dirección es obligatoria.</div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex="100">
            <label>Descripcción</label>
            <textarea required="" name="edesc" ng-model="backOEstVM.selectedEst.desc" flex="100"></textarea>
            <div ng-messages="updateEstabFormM.edesc.$error" ng-show="updateEstabFormM.edesc.$touched || updateEstabFormM.$submitted">
                <div ng-message="required" class="input-error" name="rdesc">La descripción es obligatoria.</div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex="40" flex-md="100" flex-xs="100">
            <label>Sitio Web</label>
            <input name="eweb" ng-model="backOEstVM.selectedEst.website" flex="100" type="url"/>
            <div ng-messages="updateEstabFormM.eweb.$error" ng-show="updateEstabFormM.eweb.$touched || updateEstabFormM.$submitted">
                <div ng-show="updateEstabFormM.$error.url" class="input-error" name="purl">La url del sitio web no es correcta.</div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex="100" show-gt-sm show-md show-gt-md show-lg show-gt-lg show-xl hide-sm hide-xs>
            <md-button type="submit" class="md-raised md-primary" id="update-est-btn" name="update-est-btn">
                Actualizar
            </md-button>
        </md-input-container>
        <md-input-container hide-gt-sm hide-md hide-gt-md hide-lg hide-gt-lg hide-xl show-sm show-xs layout="column" flex="100">
            <md-button type="submit" class="md-raised md-primary" id="update-est-btn" name="update-est-btn">
                Actualizar
            </md-button>
        </md-input-container>
    </form>
</md-content>